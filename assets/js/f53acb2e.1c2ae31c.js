"use strict";(globalThis.webpackChunkhome=globalThis.webpackChunkhome||[]).push([[7512],{1736(e,t,a){a.r(t),a.d(t,{assets:()=>d,contentTitle:()=>l,default:()=>h,frontMatter:()=>r,metadata:()=>i,toc:()=>u});const i=JSON.parse('{"id":"xks/operator-guide/blast-radius","title":"Blast Radius","description":"As part of ourTterraform pipelines at Xenit we use something called OPA Blast Radius to make sure that we do not do to big changes during a single commit and do not remove needed infrastructure by mistake.","source":"@site/docs/xks/operator-guide/blast-radius.md","sourceDirName":"xks/operator-guide","slug":"/xks/operator-guide/blast-radius","permalink":"/docs/xks/operator-guide/blast-radius","draft":false,"unlisted":false,"editUrl":"https://github.com/xenitab/xenitab.github.io/edit/main/docs/xks/operator-guide/blast-radius.md","tags":[],"version":"current","frontMatter":{"id":"blast-radius","title":"Blast Radius"},"sidebar":"docs","previous":{"title":"Networking","permalink":"/docs/xks/operator-guide/networking"},"next":{"title":"Blue Green Clusters","permalink":"/docs/xks/operator-guide/blue-green"}}');var n=a(4848),s=a(8453),o=a(8180);const r={id:"blast-radius",title:"Blast Radius"},l=void 0,d={},u=[{value:"Workflow",id:"workflow",level:2},{value:"OPA Blast Radius calculation",id:"opa-blast-radius-calculation",level:2},{value:"Overwrite OPA blast radius locally",id:"overwrite-opa-blast-radius-locally",level:2},{value:"Overwrite OPA blast radius in CI",id:"overwrite-opa-blast-radius-in-ci",level:2}];function c(e){const t={a:"a",code:"code",h2:"h2",p:"p",pre:"pre",...(0,s.R)(),...e.components};return(0,n.jsxs)(n.Fragment,{children:[(0,n.jsx)(t.p,{children:"As part of ourTterraform pipelines at Xenit we use something called OPA Blast Radius to make sure that we do not do to big changes during a single commit and do not remove needed infrastructure by mistake."}),"\n",(0,n.jsx)(t.h2,{id:"workflow",children:"Workflow"}),"\n",(0,n.jsx)(t.p,{children:"Our normal way of working uses a Makefile to make managing commands easier."}),"\n",(0,n.jsx)(t.p,{children:"When running Terraform locally and in our CI pipelines we use our Markdown files."}),"\n",(0,n.jsx)(t.h2,{id:"opa-blast-radius-calculation",children:"OPA Blast Radius calculation"}),"\n",(0,n.jsx)(t.p,{children:"The calculation of the blast radius value is done in the Dockerfile that is started through the Makefile."}),"\n",(0,n.jsxs)(t.p,{children:["We use ",(0,n.jsx)(t.a,{href:"https://www.openpolicyagent.org/",children:"OPA"})," to calculate the blast radius itself.\nTo see exactly how we do it you can look in this ",(0,n.jsx)(t.a,{href:"https://github.com/XenitAB/github-actions/blob/main/docker/terraform.sh",children:"bash script"})]}),"\n",(0,n.jsx)(t.p,{children:"The default value is currently set to 50."}),"\n",(0,n.jsx)(t.h2,{id:"overwrite-opa-blast-radius-locally",children:"Overwrite OPA blast radius locally"}),"\n",(0,n.jsxs)(t.p,{children:["Run your ",(0,n.jsx)(t.code,{children:"make"})," command normally, but when running ",(0,n.jsx)(t.code,{children:"plan"})," add ",(0,n.jsx)(t.code,{children:"OPA_BLAST_RADIUS"})," and the value you want."]}),"\n",(0,n.jsx)(t.pre,{children:(0,n.jsx)(t.code,{className:"language-shell",children:"make plan ENV=dev DIR=governance OPA_BLAST_RADIUS=51\n"})}),"\n",(0,n.jsx)(t.h2,{id:"overwrite-opa-blast-radius-in-ci",children:"Overwrite OPA blast radius in CI"}),"\n",(0,n.jsx)(t.p,{children:"We are using Just Enough Administration (JEA) at Xenit and in many cases our admins do not have enough access to run Terraform plan/apply locally.\nInstead we are forced to use our CI/CD systems to manage this for us."}),"\n",(0,n.jsxs)(t.p,{children:["If you look at the ",(0,n.jsx)(t.code,{children:"Makefile"})," you will see that we do not use any environment variables to overwrite the ",(0,n.jsx)(t.code,{children:"OPA_BLAST_RADIUS"})," value.\nSo how should we change the ",(0,n.jsx)(t.code,{children:"OPA_BLAST_RADIUS"})," without having to update the pipeline file every time we want to overwrite the default value?"]}),"\n",(0,n.jsxs)(t.p,{children:["Sadly here comes some magic, if you look in ",(0,n.jsx)(t.a,{href:"https://github.com/XenitAB/azure-devops-templates/blob/594c374cb5418c415737fdb688049d4138f2d67f/terraform-docker/plan/main.yaml#L107",children:"https://github.com/XenitAB/azure-devops-templates/"}),"\nyou will see that we are listening for the environment variable ",(0,n.jsx)(t.code,{children:"opaBlastRadius"}),"."]}),"\n",(0,n.jsxs)(t.p,{children:["So to overwrite the ",(0,n.jsx)(t.code,{children:"OPA_BLAST_RADIUS"})," value during a single run we can utilize the ",(0,n.jsx)(t.code,{children:"opaBlastRadius"})," environment variable."]}),"\n",(0,n.jsx)(t.p,{children:"To add a custom value to your pipeline in Azure DevOps do the following:"}),"\n",(0,n.jsx)(t.p,{children:'Pipelines -> "pipeline-you-want-to-run" -> Run pipeline -> Variables -> Add variable'}),"\n",(0,n.jsxs)(t.p,{children:["Add ",(0,n.jsx)(t.code,{children:"opaBlastRadius=51"}),", it should look something like this:"]}),"\n",(0,n.jsx)("img",{alt:"Blast Radius",src:(0,o.Ay)("img/assets/xks/operator-guide/opaBlastRadius.png")}),"\n",(0,n.jsxs)(t.p,{children:["To start the job you have to push the back arrow ",(0,n.jsx)(t.code,{children:"<-"})," and Run."]}),"\n",(0,n.jsx)(t.p,{children:"Remember, this variable is only set for one run."})]})}function h(e={}){const{wrapper:t}={...(0,s.R)(),...e.components};return t?(0,n.jsx)(t,{...e,children:(0,n.jsx)(c,{...e})}):c(e)}},8453(e,t,a){a.d(t,{R:()=>o,x:()=>r});var i=a(6540);const n={},s=i.createContext(n);function o(e){const t=i.useContext(s);return i.useMemo(function(){return"function"==typeof e?e(t):{...t,...e}},[t,e])}function r(e){let t;return t=e.disableParentContext?"function"==typeof e.components?e.components(n):e.components||n:o(e.components),i.createElement(s.Provider,{value:t},e.children)}}}]);