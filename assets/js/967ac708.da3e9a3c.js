"use strict";(globalThis.webpackChunkhome=globalThis.webpackChunkhome||[]).push([[960],{465(e,n,i){i.r(n),i.d(n,{assets:()=>c,contentTitle:()=>l,default:()=>p,frontMatter:()=>o,metadata:()=>a,toc:()=>d});const a=JSON.parse('{"id":"xks/operator-guide/ingress-nginx deprecation/envoy-gateway","title":"Envoy Gateway","description":"Overview","source":"@site/docs/xks/operator-guide/ingress-nginx deprecation/envoy-gateway.md","sourceDirName":"xks/operator-guide/ingress-nginx deprecation","slug":"/xks/operator-guide/ingress-nginx deprecation/envoy-gateway","permalink":"/docs/xks/operator-guide/ingress-nginx deprecation/envoy-gateway","draft":false,"unlisted":false,"editUrl":"https://github.com/xenitab/xenitab.github.io/edit/main/docs/xks/operator-guide/ingress-nginx deprecation/envoy-gateway.md","tags":[],"version":"current","frontMatter":{"id":"envoy-gateway","title":"Envoy Gateway"},"sidebar":"docs","previous":{"title":"Gateway API","permalink":"/docs/xks/operator-guide/ingress-nginx deprecation/gateway-api"},"next":{"title":"Containers","permalink":"/docs/xenit-style-guide/containers"}}');var t=i(4848),s=i(8453),r=i(8180);const o={id:"envoy-gateway",title:"Envoy Gateway"},l=void 0,c={},d=[{value:"Overview",id:"overview",level:2},{value:"Why Envoy Gateway?",id:"why-envoy-gateway",level:2},{value:"Modern Cloud-Native Architecture",id:"modern-cloud-native-architecture",level:3},{value:"Native Gateway API Support",id:"native-gateway-api-support",level:3},{value:"Advanced Traffic Management",id:"advanced-traffic-management",level:3},{value:"Superior Observability",id:"superior-observability",level:3},{value:"Service Mesh Integration",id:"service-mesh-integration",level:3},{value:"Extensibility",id:"extensibility",level:3},{value:"Architecture",id:"architecture",level:2},{value:"Control Plane",id:"control-plane",level:3},{value:"Data Plane",id:"data-plane",level:3},{value:"Configuration",id:"configuration",level:2},{value:"BackendTrafficPolicy",id:"backendtrafficpolicy",level:3},{value:"Rate Limiting",id:"rate-limiting",level:4},{value:"Load Balancing",id:"load-balancing",level:4},{value:"Session Affinity",id:"session-affinity",level:4},{value:"Circuit Breaking",id:"circuit-breaking",level:4},{value:"Timeout and Retry",id:"timeout-and-retry",level:4},{value:"Health Checks",id:"health-checks",level:4},{value:"ClientTrafficPolicy",id:"clienttrafficpolicy",level:3},{value:"Client Timeout",id:"client-timeout",level:4},{value:"HTTP/2 and HTTP/3",id:"http2-and-http3",level:4},{value:"Client IP Detection",id:"client-ip-detection",level:4},{value:"Path Normalization",id:"path-normalization",level:4},{value:"SecurityPolicy",id:"securitypolicy",level:3},{value:"CORS Policy",id:"cors-policy",level:4},{value:"Basic Authentication",id:"basic-authentication",level:4},{value:"External Authorization",id:"external-authorization",level:4},{value:"JWT Authentication",id:"jwt-authentication",level:4},{value:"Backend TLS",id:"backend-tls",level:3},{value:"Observability",id:"observability",level:2},{value:"Metrics",id:"metrics",level:3},{value:"Access Logs",id:"access-logs",level:3},{value:"Distributed Tracing",id:"distributed-tracing",level:3},{value:"Performance Tuning",id:"performance-tuning",level:2},{value:"Resource Allocation",id:"resource-allocation",level:3},{value:"Horizontal Scaling",id:"horizontal-scaling",level:3},{value:"Connection Pooling",id:"connection-pooling",level:3},{value:"Debugging",id:"debugging",level:2},{value:"View Envoy Configuration",id:"view-envoy-configuration",level:3},{value:"Check Runtime Statistics",id:"check-runtime-statistics",level:3},{value:"Enable Debug Logging",id:"enable-debug-logging",level:3},{value:"Common Issues",id:"common-issues",level:3},{value:"Extensibility",id:"extensibility-1",level:2},{value:"WASM Filters",id:"wasm-filters",level:3},{value:"External Processors",id:"external-processors",level:3},{value:"Further Reading",id:"further-reading",level:2}];function h(e){const n={a:"a",code:"code",h2:"h2",h3:"h3",h4:"h4",li:"li",p:"p",pre:"pre",strong:"strong",ul:"ul",...(0,s.R)(),...e.components};return(0,t.jsxs)(t.Fragment,{children:[(0,t.jsx)(n.h2,{id:"overview",children:"Overview"}),"\n",(0,t.jsxs)(n.p,{children:[(0,t.jsx)(n.a,{href:"https://gateway.envoyproxy.io/",children:"Envoy Gateway"})," is XKS's implementation of the Kubernetes Gateway API, providing a powerful and performant ingress solution built on ",(0,t.jsx)(n.a,{href:"https://www.envoyproxy.io/",children:"Envoy Proxy"}),". Envoy Gateway combines the maturity and capabilities of Envoy with a Kubernetes-native control plane designed specifically for the Gateway API."]}),"\n",(0,t.jsx)(n.h2,{id:"why-envoy-gateway",children:"Why Envoy Gateway?"}),"\n",(0,t.jsx)(n.h3,{id:"modern-cloud-native-architecture",children:"Modern Cloud-Native Architecture"}),"\n",(0,t.jsx)(n.p,{children:"Envoy Proxy was designed from the ground up for cloud-native environments:"}),"\n",(0,t.jsxs)(n.ul,{children:["\n",(0,t.jsxs)(n.li,{children:[(0,t.jsx)(n.strong,{children:"Dynamic Configuration"}),": Updates configuration without reloading or dropping connections, ensuring zero-downtime changes"]}),"\n",(0,t.jsxs)(n.li,{children:[(0,t.jsx)(n.strong,{children:"API-Driven"}),": Controlled via xDS (Discovery Service) APIs, enabling sophisticated runtime traffic management"]}),"\n",(0,t.jsxs)(n.li,{children:[(0,t.jsx)(n.strong,{children:"High Performance"}),": Optimized for high-throughput, low-latency scenarios with efficient resource utilization"]}),"\n",(0,t.jsxs)(n.li,{children:[(0,t.jsx)(n.strong,{children:"Battle-Tested"}),": Powers major platforms including AWS App Mesh, Google Traffic Director, and is the data plane for most service meshes"]}),"\n"]}),"\n",(0,t.jsx)(n.h3,{id:"native-gateway-api-support",children:"Native Gateway API Support"}),"\n",(0,t.jsx)(n.p,{children:"Envoy Gateway is purpose-built to implement the Gateway API specification:"}),"\n",(0,t.jsxs)(n.ul,{children:["\n",(0,t.jsxs)(n.li,{children:[(0,t.jsx)(n.strong,{children:"First-Class Support"}),": All Gateway API resources map directly to Envoy's native capabilities"]}),"\n",(0,t.jsxs)(n.li,{children:[(0,t.jsx)(n.strong,{children:"Clean Architecture"}),": Clear separation between control plane (Envoy Gateway) and data plane (Envoy Proxy)"]}),"\n",(0,t.jsxs)(n.li,{children:[(0,t.jsx)(n.strong,{children:"Specification Compliance"}),": Regular updates aligned with Gateway API releases and standards"]}),"\n",(0,t.jsxs)(n.li,{children:[(0,t.jsx)(n.strong,{children:"No Translation Layer"}),": Features work natively without annotation-based workarounds"]}),"\n"]}),"\n",(0,t.jsx)(n.h3,{id:"advanced-traffic-management",children:"Advanced Traffic Management"}),"\n",(0,t.jsx)(n.p,{children:"Envoy provides sophisticated Layer 7 capabilities out of the box:"}),"\n",(0,t.jsxs)(n.ul,{children:["\n",(0,t.jsxs)(n.li,{children:[(0,t.jsx)(n.strong,{children:"Circuit Breaking"}),": Protect services from cascading failures with configurable thresholds"]}),"\n",(0,t.jsxs)(n.li,{children:[(0,t.jsx)(n.strong,{children:"Intelligent Retries"}),": Fine-grained retry policies with exponential backoff and budget controls"]}),"\n",(0,t.jsxs)(n.li,{children:[(0,t.jsx)(n.strong,{children:"Load Balancing"}),": Multiple algorithms including round-robin, least request, ring hash, and maglev"]}),"\n",(0,t.jsxs)(n.li,{children:[(0,t.jsx)(n.strong,{children:"Health Checking"}),": Active and passive health checks with customizable intervals and thresholds"]}),"\n",(0,t.jsxs)(n.li,{children:[(0,t.jsx)(n.strong,{children:"Rate Limiting"}),": Both local (per-instance) and global (distributed) rate limiting strategies"]}),"\n"]}),"\n",(0,t.jsx)(n.h3,{id:"superior-observability",children:"Superior Observability"}),"\n",(0,t.jsx)(n.p,{children:"Observability is built into Envoy's core, not bolted on:"}),"\n",(0,t.jsxs)(n.ul,{children:["\n",(0,t.jsxs)(n.li,{children:[(0,t.jsx)(n.strong,{children:"Rich Metrics"}),": Detailed statistics for requests, connections, clusters, and more via Prometheus"]}),"\n",(0,t.jsxs)(n.li,{children:[(0,t.jsx)(n.strong,{children:"Distributed Tracing"}),": Native support for Jaeger, Zipkin, and OpenTelemetry"]}),"\n",(0,t.jsxs)(n.li,{children:[(0,t.jsx)(n.strong,{children:"Structured Logging"}),": Comprehensive access logs with customizable formats"]}),"\n",(0,t.jsxs)(n.li,{children:[(0,t.jsx)(n.strong,{children:"Admin Interface"}),": Real-time debugging and configuration inspection via HTTP API"]}),"\n"]}),"\n",(0,t.jsx)(n.h3,{id:"service-mesh-integration",children:"Service Mesh Integration"}),"\n",(0,t.jsx)(n.p,{children:"Envoy is the data plane of choice for major service mesh implementations:"}),"\n",(0,t.jsxs)(n.ul,{children:["\n",(0,t.jsxs)(n.li,{children:[(0,t.jsx)(n.strong,{children:"Istio"}),": Uses Envoy for both ingress gateways and service mesh"]}),"\n",(0,t.jsxs)(n.li,{children:[(0,t.jsx)(n.strong,{children:"Linkerd"}),": Supports Envoy as an alternative data plane"]}),"\n",(0,t.jsxs)(n.li,{children:[(0,t.jsx)(n.strong,{children:"Consul Connect"}),": Uses Envoy for service-to-service communication"]}),"\n",(0,t.jsxs)(n.li,{children:[(0,t.jsx)(n.strong,{children:"AWS App Mesh"}),": Built entirely on Envoy"]}),"\n"]}),"\n",(0,t.jsx)(n.p,{children:"Using Envoy Gateway provides a unified architecture if you adopt a service mesh in the future."}),"\n",(0,t.jsx)(n.h3,{id:"extensibility",children:"Extensibility"}),"\n",(0,t.jsx)(n.p,{children:"Envoy's filter architecture enables powerful extensions:"}),"\n",(0,t.jsxs)(n.ul,{children:["\n",(0,t.jsxs)(n.li,{children:[(0,t.jsx)(n.strong,{children:"WASM Filters"}),": Write custom logic in multiple languages (Rust, Go, C++, AssemblyScript)"]}),"\n",(0,t.jsxs)(n.li,{children:[(0,t.jsx)(n.strong,{children:"External Authorization"}),": Integrate with external auth services via gRPC/HTTP"]}),"\n",(0,t.jsxs)(n.li,{children:[(0,t.jsx)(n.strong,{children:"Custom Filters"}),": Native Envoy filters for advanced use cases"]}),"\n",(0,t.jsxs)(n.li,{children:[(0,t.jsx)(n.strong,{children:"Rate Limit Service"}),": Pluggable external rate limiting service"]}),"\n"]}),"\n",(0,t.jsx)(n.h2,{id:"architecture",children:"Architecture"}),"\n",(0,t.jsx)("img",{alt:"Envoy Gateway Architecture",src:(0,r.Ay)("img/assets/xks/developer-guide/envoy-gateway-architecture.jpg")}),"\n",(0,t.jsx)(n.p,{children:"Envoy Gateway consists of two main components:"}),"\n",(0,t.jsx)(n.h3,{id:"control-plane",children:"Control Plane"}),"\n",(0,t.jsx)(n.p,{children:"The Envoy Gateway control plane:"}),"\n",(0,t.jsxs)(n.ul,{children:["\n",(0,t.jsx)(n.li,{children:"Watches Gateway API resources (Gateway, HTTPRoute, etc.)"}),"\n",(0,t.jsx)(n.li,{children:"Translates them into Envoy xDS configuration"}),"\n",(0,t.jsx)(n.li,{children:"Manages Envoy Proxy deployments"}),"\n",(0,t.jsx)(n.li,{children:"Handles certificate lifecycle via integration with Cert Manager"}),"\n"]}),"\n",(0,t.jsx)(n.h3,{id:"data-plane",children:"Data Plane"}),"\n",(0,t.jsx)(n.p,{children:"The Envoy Proxy data plane:"}),"\n",(0,t.jsxs)(n.ul,{children:["\n",(0,t.jsx)(n.li,{children:"Receives dynamic configuration from the control plane"}),"\n",(0,t.jsx)(n.li,{children:"Routes and processes traffic based on configuration"}),"\n",(0,t.jsx)(n.li,{children:"Reports metrics and traces"}),"\n",(0,t.jsx)(n.li,{children:"Performs health checking and load balancing"}),"\n"]}),"\n",(0,t.jsx)(n.h2,{id:"configuration",children:"Configuration"}),"\n",(0,t.jsx)(n.h3,{id:"backendtrafficpolicy",children:"BackendTrafficPolicy"}),"\n",(0,t.jsx)(n.p,{children:"BackendTrafficPolicy configures how traffic is handled between the Gateway and backend services."}),"\n",(0,t.jsx)(n.h4,{id:"rate-limiting",children:"Rate Limiting"}),"\n",(0,t.jsx)(n.p,{children:"Local rate limiting (per Envoy instance):"}),"\n",(0,t.jsx)(n.pre,{children:(0,t.jsx)(n.code,{className:"language-yaml",children:"apiVersion: gateway.envoyproxy.io/v1alpha1\nkind: BackendTrafficPolicy\nmetadata:\n  name: rate-limit-policy\n  namespace: tenant\nspec:\n  targetRef:\n    group: gateway.networking.k8s.io\n    kind: HTTPRoute\n    name: example-app\n  rateLimit:\n    type: Local\n    local:\n      rules:\n        - clientSelectors:\n            - headers:\n                - name: x-user-id\n                  type: Distinct\n          limit:\n            requests: 100\n            unit: Minute\n"})}),"\n",(0,t.jsx)(n.p,{children:"Global rate limiting (distributed across all instances):"}),"\n",(0,t.jsx)(n.pre,{children:(0,t.jsx)(n.code,{className:"language-yaml",children:"apiVersion: gateway.envoyproxy.io/v1alpha1\nkind: BackendTrafficPolicy\nmetadata:\n  name: global-rate-limit\n  namespace: tenant\nspec:\n  targetRef:\n    group: gateway.networking.k8s.io\n    kind: HTTPRoute\n    name: example-app\n  rateLimit:\n    type: Global\n    global:\n      rules:\n        - clientSelectors:\n            - sourceCIDR:\n                type: Distinct\n          limit:\n            requests: 10000\n            unit: Hour\n"})}),"\n",(0,t.jsx)(n.h4,{id:"load-balancing",children:"Load Balancing"}),"\n",(0,t.jsx)(n.p,{children:"Configure load balancing algorithm:"}),"\n",(0,t.jsx)(n.pre,{children:(0,t.jsx)(n.code,{className:"language-yaml",children:"apiVersion: gateway.envoyproxy.io/v1alpha1\nkind: BackendTrafficPolicy\nmetadata:\n  name: load-balancer\n  namespace: tenant\nspec:\n  targetRef:\n    group: gateway.networking.k8s.io\n    kind: HTTPRoute\n    name: example-app\n  loadBalancer:\n    type: ConsistentHash\n    consistentHash:\n      type: Header\n      header:\n        name: X-User-ID\n"})}),"\n",(0,t.jsx)(n.p,{children:"Available load balancing types:"}),"\n",(0,t.jsxs)(n.ul,{children:["\n",(0,t.jsxs)(n.li,{children:[(0,t.jsx)(n.strong,{children:"RoundRobin"}),": Distribute requests evenly (default)"]}),"\n",(0,t.jsxs)(n.li,{children:[(0,t.jsx)(n.strong,{children:"LeastRequest"}),": Send to backend with fewest active requests"]}),"\n",(0,t.jsxs)(n.li,{children:[(0,t.jsx)(n.strong,{children:"Random"}),": Random selection"]}),"\n",(0,t.jsxs)(n.li,{children:[(0,t.jsx)(n.strong,{children:"ConsistentHash"}),": Hash-based routing for session affinity"]}),"\n"]}),"\n",(0,t.jsx)(n.h4,{id:"session-affinity",children:"Session Affinity"}),"\n",(0,t.jsx)(n.p,{children:"Maintain sticky sessions:"}),"\n",(0,t.jsx)(n.pre,{children:(0,t.jsx)(n.code,{className:"language-yaml",children:"apiVersion: gateway.envoyproxy.io/v1alpha1\nkind: BackendTrafficPolicy\nmetadata:\n  name: session-affinity\n  namespace: tenant\nspec:\n  targetRef:\n    group: gateway.networking.k8s.io\n    kind: HTTPRoute\n    name: example-app\n  loadBalancer:\n    type: ConsistentHash\n    consistentHash:\n      type: Cookie\n      cookie:\n        name: session-cookie\n        ttl: 3600s\n"})}),"\n",(0,t.jsx)(n.h4,{id:"circuit-breaking",children:"Circuit Breaking"}),"\n",(0,t.jsx)(n.p,{children:"Protect services from overload:"}),"\n",(0,t.jsx)(n.pre,{children:(0,t.jsx)(n.code,{className:"language-yaml",children:"apiVersion: gateway.envoyproxy.io/v1alpha1\nkind: BackendTrafficPolicy\nmetadata:\n  name: circuit-breaker\n  namespace: tenant\nspec:\n  targetRef:\n    group: gateway.networking.k8s.io\n    kind: HTTPRoute\n    name: example-app\n  circuitBreaker:\n    maxConnections: 1024\n    maxPendingRequests: 1024\n    maxRequests: 1024\n    maxRetries: 3\n    maxRequestsPerConnection: 100\n"})}),"\n",(0,t.jsx)(n.h4,{id:"timeout-and-retry",children:"Timeout and Retry"}),"\n",(0,t.jsx)(n.p,{children:"Configure request timeouts and retry behavior:"}),"\n",(0,t.jsx)(n.pre,{children:(0,t.jsx)(n.code,{className:"language-yaml",children:"apiVersion: gateway.envoyproxy.io/v1alpha1\nkind: BackendTrafficPolicy\nmetadata:\n  name: timeout-retry\n  namespace: tenant\nspec:\n  targetRef:\n    group: gateway.networking.k8s.io\n    kind: HTTPRoute\n    name: example-app\n  timeout:\n    request: 10s\n    backendRequest: 8s\n  retry:\n    numRetries: 3\n    perRetryTimeout: 3s\n    retryOn:\n      httpStatusCodes:\n        - 500\n        - 502\n        - 503\n        - 504\n      triggers:\n        - connect-failure\n        - refused-stream\n        - retriable-4xx\n"})}),"\n",(0,t.jsx)(n.h4,{id:"health-checks",children:"Health Checks"}),"\n",(0,t.jsx)(n.p,{children:"Active health checking:"}),"\n",(0,t.jsx)(n.pre,{children:(0,t.jsx)(n.code,{className:"language-yaml",children:'apiVersion: gateway.envoyproxy.io/v1alpha1\nkind: BackendTrafficPolicy\nmetadata:\n  name: health-check\n  namespace: tenant\nspec:\n  targetRef:\n    group: gateway.networking.k8s.io\n    kind: HTTPRoute\n    name: example-app\n  healthCheck:\n    active:\n      type: HTTP\n      http:\n        path: /health\n        method: GET\n        expectedStatuses:\n          - 200\n          - 204\n        expectedResponse:\n          type: Text\n          text: "healthy"\n      timeout: 1s\n      interval: 3s\n      unhealthyThreshold: 3\n      healthyThreshold: 2\n'})}),"\n",(0,t.jsx)(n.p,{children:"Passive health checking (outlier detection):"}),"\n",(0,t.jsx)(n.pre,{children:(0,t.jsx)(n.code,{className:"language-yaml",children:"apiVersion: gateway.envoyproxy.io/v1alpha1\nkind: BackendTrafficPolicy\nmetadata:\n  name: outlier-detection\n  namespace: tenant\nspec:\n  targetRef:\n    group: gateway.networking.k8s.io\n    kind: HTTPRoute\n    name: example-app\n  healthCheck:\n    passive:\n      consecutive5xxErrors: 5\n      interval: 10s\n      baseEjectionTime: 30s\n      maxEjectionPercent: 50\n      splitExternalLocalOriginErrors: true\n"})}),"\n",(0,t.jsx)(n.h3,{id:"clienttrafficpolicy",children:"ClientTrafficPolicy"}),"\n",(0,t.jsx)(n.p,{children:"ClientTrafficPolicy configures how traffic is handled between clients and the Gateway."}),"\n",(0,t.jsx)(n.h4,{id:"client-timeout",children:"Client Timeout"}),"\n",(0,t.jsx)(n.p,{children:"Set client-side timeouts:"}),"\n",(0,t.jsx)(n.pre,{children:(0,t.jsx)(n.code,{className:"language-yaml",children:"apiVersion: gateway.envoyproxy.io/v1alpha1\nkind: ClientTrafficPolicy\nmetadata:\n  name: client-timeout\n  namespace: gateway-system\nspec:\n  targetRef:\n    group: gateway.networking.k8s.io\n    kind: Gateway\n    name: default-gateway\n  timeout:\n    http:\n      requestReceivedTimeout: 30s\n"})}),"\n",(0,t.jsx)(n.h4,{id:"http2-and-http3",children:"HTTP/2 and HTTP/3"}),"\n",(0,t.jsx)(n.p,{children:"Enable HTTP/2 and HTTP/3:"}),"\n",(0,t.jsx)(n.pre,{children:(0,t.jsx)(n.code,{className:"language-yaml",children:"apiVersion: gateway.envoyproxy.io/v1alpha1\nkind: ClientTrafficPolicy\nmetadata:\n  name: http-versions\n  namespace: gateway-system\nspec:\n  targetRef:\n    group: gateway.networking.k8s.io\n    kind: Gateway\n    name: default-gateway\n  http2:\n    maxConcurrentStreams: 128\n  http3: {}\n"})}),"\n",(0,t.jsx)(n.h4,{id:"client-ip-detection",children:"Client IP Detection"}),"\n",(0,t.jsx)(n.p,{children:"Configure how client IPs are detected (important when behind load balancers):"}),"\n",(0,t.jsx)(n.pre,{children:(0,t.jsx)(n.code,{className:"language-yaml",children:"apiVersion: gateway.envoyproxy.io/v1alpha1\nkind: ClientTrafficPolicy\nmetadata:\n  name: client-ip-detection\n  namespace: gateway-system\nspec:\n  targetRef:\n    group: gateway.networking.k8s.io\n    kind: Gateway\n    name: default-gateway\n  clientIPDetection:\n    xForwardedFor:\n      numTrustedHops: 1\n"})}),"\n",(0,t.jsx)(n.h4,{id:"path-normalization",children:"Path Normalization"}),"\n",(0,t.jsx)(n.p,{children:"Configure URL path normalization:"}),"\n",(0,t.jsx)(n.pre,{children:(0,t.jsx)(n.code,{className:"language-yaml",children:"apiVersion: gateway.envoyproxy.io/v1alpha1\nkind: ClientTrafficPolicy\nmetadata:\n  name: path-normalization\n  namespace: gateway-system\nspec:\n  targetRef:\n    group: gateway.networking.k8s.io\n    kind: Gateway\n    name: default-gateway\n  path:\n    mergeSlashes: true\n    escapedSlashesAction: UnescapeAndRedirect\n"})}),"\n",(0,t.jsx)(n.h3,{id:"securitypolicy",children:"SecurityPolicy"}),"\n",(0,t.jsx)(n.p,{children:"SecurityPolicy provides security-related configuration."}),"\n",(0,t.jsx)(n.h4,{id:"cors-policy",children:"CORS Policy"}),"\n",(0,t.jsx)(n.p,{children:"Configure Cross-Origin Resource Sharing:"}),"\n",(0,t.jsx)(n.pre,{children:(0,t.jsx)(n.code,{className:"language-yaml",children:'apiVersion: gateway.envoyproxy.io/v1alpha1\nkind: SecurityPolicy\nmetadata:\n  name: cors-policy\n  namespace: tenant\nspec:\n  targetRef:\n    group: gateway.networking.k8s.io\n    kind: HTTPRoute\n    name: example-app\n  cors:\n    allowOrigins:\n      - "https://example.com"\n      - "https://*.example.com"\n    allowMethods:\n      - GET\n      - POST\n      - PUT\n      - DELETE\n    allowHeaders:\n      - Content-Type\n      - Authorization\n      - X-Custom-Header\n    exposeHeaders:\n      - X-Response-ID\n    maxAge: 86400\n    allowCredentials: true\n'})}),"\n",(0,t.jsx)(n.h4,{id:"basic-authentication",children:"Basic Authentication"}),"\n",(0,t.jsx)(n.p,{children:"Enable basic authentication:"}),"\n",(0,t.jsx)(n.pre,{children:(0,t.jsx)(n.code,{className:"language-yaml",children:"apiVersion: gateway.envoyproxy.io/v1alpha1\nkind: SecurityPolicy\nmetadata:\n  name: basic-auth\n  namespace: tenant\nspec:\n  targetRef:\n    group: gateway.networking.k8s.io\n    kind: HTTPRoute\n    name: example-app\n  basicAuth:\n    users:\n      name: basic-auth-secret\n---\napiVersion: v1\nkind: Secret\nmetadata:\n  name: basic-auth-secret\n  namespace: tenant\ntype: Opaque\nstringData:\n  .htpasswd: |\n    user1:$apr1$...\n    user2:$apr1$...\n"})}),"\n",(0,t.jsx)(n.h4,{id:"external-authorization",children:"External Authorization"}),"\n",(0,t.jsx)(n.p,{children:"Integrate with external authorization service:"}),"\n",(0,t.jsx)(n.pre,{children:(0,t.jsx)(n.code,{className:"language-yaml",children:"apiVersion: gateway.envoyproxy.io/v1alpha1\nkind: SecurityPolicy\nmetadata:\n  name: ext-auth\n  namespace: tenant\nspec:\n  targetRef:\n    group: gateway.networking.k8s.io\n    kind: HTTPRoute\n    name: example-app\n  extAuth:\n    grpc:\n      backendRef:\n        name: auth-service\n        port: 9000\n    headersToBackend:\n      - authorization\n    failOpen: false\n"})}),"\n",(0,t.jsx)(n.h4,{id:"jwt-authentication",children:"JWT Authentication"}),"\n",(0,t.jsx)(n.p,{children:"Validate JWT tokens:"}),"\n",(0,t.jsx)(n.pre,{children:(0,t.jsx)(n.code,{className:"language-yaml",children:'apiVersion: gateway.envoyproxy.io/v1alpha1\nkind: SecurityPolicy\nmetadata:\n  name: jwt-auth\n  namespace: tenant\nspec:\n  targetRef:\n    group: gateway.networking.k8s.io\n    kind: HTTPRoute\n    name: example-app\n  jwt:\n    providers:\n      - name: auth0\n        issuer: "https://example.auth0.com/"\n        audiences:\n          - "https://api.example.com"\n        remoteJWKS:\n          uri: "https://example.auth0.com/.well-known/jwks.json"\n        claimToHeaders:\n          - claim: sub\n            header: X-User-ID\n'})}),"\n",(0,t.jsx)(n.h3,{id:"backend-tls",children:"Backend TLS"}),"\n",(0,t.jsx)(n.p,{children:"Configure TLS for backend connections:"}),"\n",(0,t.jsx)(n.pre,{children:(0,t.jsx)(n.code,{className:"language-yaml",children:"apiVersion: gateway.networking.k8s.io/v1alpha2\nkind: BackendTLSPolicy\nmetadata:\n  name: backend-tls\n  namespace: tenant\nspec:\n  targetRef:\n    group: ''\n    kind: Service\n    name: backend-service\n  tls:\n    certificateAuthorityRefs:\n      - name: backend-ca-cert\n        group: ''\n        kind: ConfigMap\n    hostname: backend.internal.example.com\n"})}),"\n",(0,t.jsx)(n.h2,{id:"observability",children:"Observability"}),"\n",(0,t.jsx)(n.h3,{id:"metrics",children:"Metrics"}),"\n",(0,t.jsx)(n.p,{children:"Envoy Gateway exposes Prometheus metrics for monitoring:"}),"\n",(0,t.jsxs)(n.ul,{children:["\n",(0,t.jsxs)(n.li,{children:[(0,t.jsx)(n.strong,{children:"Gateway metrics"}),": Available at ",(0,t.jsx)(n.code,{children:":19001/stats/prometheus"})," on Gateway pods"]}),"\n",(0,t.jsxs)(n.li,{children:[(0,t.jsx)(n.strong,{children:"Envoy Proxy metrics"}),": Available at ",(0,t.jsx)(n.code,{children:":19001/stats/prometheus"})," on Envoy pods"]}),"\n"]}),"\n",(0,t.jsx)(n.p,{children:"Key metrics to monitor:"}),"\n",(0,t.jsxs)(n.ul,{children:["\n",(0,t.jsxs)(n.li,{children:[(0,t.jsx)(n.code,{children:"envoy_http_downstream_rq_total"}),": Total requests received"]}),"\n",(0,t.jsxs)(n.li,{children:[(0,t.jsx)(n.code,{children:"envoy_http_downstream_rq_xx"}),": Requests by status code (2xx, 4xx, 5xx)"]}),"\n",(0,t.jsxs)(n.li,{children:[(0,t.jsx)(n.code,{children:"envoy_cluster_upstream_rq_total"}),": Total requests to backends"]}),"\n",(0,t.jsxs)(n.li,{children:[(0,t.jsx)(n.code,{children:"envoy_cluster_upstream_rq_time"}),": Request latency"]}),"\n",(0,t.jsxs)(n.li,{children:[(0,t.jsx)(n.code,{children:"envoy_cluster_membership_healthy"}),": Healthy backend endpoints"]}),"\n"]}),"\n",(0,t.jsx)(n.h3,{id:"access-logs",children:"Access Logs"}),"\n",(0,t.jsx)(n.p,{children:"Configure access logging:"}),"\n",(0,t.jsx)(n.pre,{children:(0,t.jsx)(n.code,{className:"language-yaml",children:'apiVersion: gateway.envoyproxy.io/v1alpha1\nkind: EnvoyProxy\nmetadata:\n  name: custom-proxy-config\n  namespace: gateway-system\nspec:\n  telemetry:\n    accessLog:\n      settings:\n        - format:\n            type: Text\n            text: |\n              [%START_TIME%] "%REQ(:METHOD)% %REQ(X-ENVOY-ORIGINAL-PATH?:PATH)% %PROTOCOL%"\n              %RESPONSE_CODE% %RESPONSE_FLAGS% %BYTES_RECEIVED% %BYTES_SENT% %DURATION%\n              "%REQ(X-FORWARDED-FOR)%" "%REQ(USER-AGENT)%" "%REQ(X-REQUEST-ID)%"\n              "%REQ(:AUTHORITY)%" "%UPSTREAM_HOST%"\n          sinks:\n            - type: File\n              file:\n                path: /dev/stdout\n'})}),"\n",(0,t.jsx)(n.p,{children:"JSON format for structured logging:"}),"\n",(0,t.jsx)(n.pre,{children:(0,t.jsx)(n.code,{className:"language-yaml",children:'apiVersion: gateway.envoyproxy.io/v1alpha1\nkind: EnvoyProxy\nmetadata:\n  name: json-logging\n  namespace: gateway-system\nspec:\n  telemetry:\n    accessLog:\n      settings:\n        - format:\n            type: JSON\n            json:\n              start_time: "%START_TIME%"\n              method: "%REQ(:METHOD)%"\n              path: "%REQ(X-ENVOY-ORIGINAL-PATH?:PATH)%"\n              protocol: "%PROTOCOL%"\n              response_code: "%RESPONSE_CODE%"\n              response_flags: "%RESPONSE_FLAGS%"\n              bytes_received: "%BYTES_RECEIVED%"\n              bytes_sent: "%BYTES_SENT%"\n              duration: "%DURATION%"\n              upstream_host: "%UPSTREAM_HOST%"\n              x_forwarded_for: "%REQ(X-FORWARDED-FOR)%"\n              user_agent: "%REQ(USER-AGENT)%"\n              request_id: "%REQ(X-REQUEST-ID)%"\n          sinks:\n            - type: File\n              file:\n                path: /dev/stdout\n'})}),"\n",(0,t.jsx)(n.h3,{id:"distributed-tracing",children:"Distributed Tracing"}),"\n",(0,t.jsx)(n.p,{children:"Enable distributed tracing with OpenTelemetry:"}),"\n",(0,t.jsx)(n.pre,{children:(0,t.jsx)(n.code,{className:"language-yaml",children:"apiVersion: gateway.envoyproxy.io/v1alpha1\nkind: EnvoyProxy\nmetadata:\n  name: tracing-config\n  namespace: gateway-system\nspec:\n  telemetry:\n    tracing:\n      provider:\n        type: OpenTelemetry\n        openTelemetry:\n          host: otel-collector.observability.svc.cluster.local\n          port: 4317\n      samplingRate: 100\n"})}),"\n",(0,t.jsx)(n.h2,{id:"performance-tuning",children:"Performance Tuning"}),"\n",(0,t.jsx)(n.h3,{id:"resource-allocation",children:"Resource Allocation"}),"\n",(0,t.jsx)(n.p,{children:"Envoy Gateway and Envoy Proxy resource requirements depend on traffic patterns:"}),"\n",(0,t.jsxs)(n.p,{children:[(0,t.jsx)(n.strong,{children:"Low Traffic"})," (< 100 RPS):"]}),"\n",(0,t.jsx)(n.pre,{children:(0,t.jsx)(n.code,{className:"language-yaml",children:"resources:\n  requests:\n    cpu: 100m\n    memory: 128Mi\n  limits:\n    cpu: 500m\n    memory: 512Mi\n"})}),"\n",(0,t.jsxs)(n.p,{children:[(0,t.jsx)(n.strong,{children:"Medium Traffic"})," (100-1000 RPS):"]}),"\n",(0,t.jsx)(n.pre,{children:(0,t.jsx)(n.code,{className:"language-yaml",children:"resources:\n  requests:\n    cpu: 500m\n    memory: 512Mi\n  limits:\n    cpu: 2000m\n    memory: 2Gi\n"})}),"\n",(0,t.jsxs)(n.p,{children:[(0,t.jsx)(n.strong,{children:"High Traffic"})," (> 1000 RPS):"]}),"\n",(0,t.jsx)(n.pre,{children:(0,t.jsx)(n.code,{className:"language-yaml",children:"resources:\n  requests:\n    cpu: 2000m\n    memory: 2Gi\n  limits:\n    cpu: 4000m\n    memory: 4Gi\n"})}),"\n",(0,t.jsx)(n.h3,{id:"horizontal-scaling",children:"Horizontal Scaling"}),"\n",(0,t.jsx)(n.p,{children:"Scale Envoy Proxy pods based on metrics:"}),"\n",(0,t.jsx)(n.pre,{children:(0,t.jsx)(n.code,{className:"language-yaml",children:"apiVersion: autoscaling/v2\nkind: HorizontalPodAutoscaler\nmetadata:\n  name: envoy-gateway-hpa\n  namespace: gateway-system\nspec:\n  scaleTargetRef:\n    apiVersion: apps/v1\n    kind: Deployment\n    name: envoy-gateway\n  minReplicas: 3\n  maxReplicas: 10\n  metrics:\n    - type: Resource\n      resource:\n        name: cpu\n        target:\n          type: Utilization\n          averageUtilization: 70\n"})}),"\n",(0,t.jsx)(n.h3,{id:"connection-pooling",children:"Connection Pooling"}),"\n",(0,t.jsx)(n.p,{children:"Optimize connection pooling for backends:"}),"\n",(0,t.jsx)(n.pre,{children:(0,t.jsx)(n.code,{className:"language-yaml",children:"apiVersion: gateway.envoyproxy.io/v1alpha1\nkind: BackendTrafficPolicy\nmetadata:\n  name: connection-pool\n  namespace: tenant\nspec:\n  targetRef:\n    group: gateway.networking.k8s.io\n    kind: HTTPRoute\n    name: example-app\n  connectionPool:\n    maxConnections: 1024\n    maxPendingRequests: 1024\n    maxRequestsPerConnection: 0  # unlimited\n    idleTimeout: 3600s\n"})}),"\n",(0,t.jsx)(n.h2,{id:"debugging",children:"Debugging"}),"\n",(0,t.jsx)(n.h3,{id:"view-envoy-configuration",children:"View Envoy Configuration"}),"\n",(0,t.jsx)(n.p,{children:"Access the Envoy admin interface to inspect configuration:"}),"\n",(0,t.jsx)(n.pre,{children:(0,t.jsx)(n.code,{className:"language-shell",children:"# Port forward to Envoy proxy pod\nkubectl port-forward -n gateway-system <envoy-pod> 19000:19000\n\n# View configuration dump\ncurl localhost:19000/config_dump | jq\n\n# View specific configuration\ncurl localhost:19000/config_dump?resource=routes\ncurl localhost:19000/config_dump?resource=clusters\ncurl localhost:19000/config_dump?resource=listeners\n"})}),"\n",(0,t.jsx)(n.h3,{id:"check-runtime-statistics",children:"Check Runtime Statistics"}),"\n",(0,t.jsx)(n.pre,{children:(0,t.jsx)(n.code,{className:"language-shell",children:"# View all stats\ncurl localhost:19000/stats\n\n# View specific stat\ncurl localhost:19000/stats?filter=http.downstream_rq\n\n# Reset counters\ncurl -X POST localhost:19000/reset_counters\n"})}),"\n",(0,t.jsx)(n.h3,{id:"enable-debug-logging",children:"Enable Debug Logging"}),"\n",(0,t.jsx)(n.p,{children:"Temporarily enable debug logging:"}),"\n",(0,t.jsx)(n.pre,{children:(0,t.jsx)(n.code,{className:"language-shell",children:"# Enable debug logging for a specific logger\ncurl -X POST localhost:19000/logging?level=debug\n\n# Enable for specific component\ncurl -X POST localhost:19000/logging?router=debug\n\n# Reset to default\ncurl -X POST localhost:19000/logging?level=info\n"})}),"\n",(0,t.jsx)(n.h3,{id:"common-issues",children:"Common Issues"}),"\n",(0,t.jsxs)(n.p,{children:[(0,t.jsx)(n.strong,{children:"HTTPRoute not accepting traffic"}),":"]}),"\n",(0,t.jsxs)(n.ul,{children:["\n",(0,t.jsxs)(n.li,{children:["Check Gateway acceptance conditions: ",(0,t.jsx)(n.code,{children:"kubectl get httproute <name> -o yaml"})]}),"\n",(0,t.jsx)(n.li,{children:"Verify BackendTrafficPolicy is targeting correct HTTPRoute"}),"\n",(0,t.jsx)(n.li,{children:"Ensure Service has healthy endpoints"}),"\n"]}),"\n",(0,t.jsxs)(n.p,{children:[(0,t.jsx)(n.strong,{children:"High latency"}),":"]}),"\n",(0,t.jsxs)(n.ul,{children:["\n",(0,t.jsx)(n.li,{children:"Check backend response times in metrics"}),"\n",(0,t.jsx)(n.li,{children:"Review circuit breaker settings"}),"\n",(0,t.jsx)(n.li,{children:"Examine retry configurations"}),"\n",(0,t.jsx)(n.li,{children:"Check connection pooling limits"}),"\n"]}),"\n",(0,t.jsxs)(n.p,{children:[(0,t.jsx)(n.strong,{children:"Rate limiting not working"}),":"]}),"\n",(0,t.jsxs)(n.ul,{children:["\n",(0,t.jsx)(n.li,{children:"Verify BackendTrafficPolicy targetRef matches HTTPRoute"}),"\n",(0,t.jsxs)(n.li,{children:["Check rate limit metrics: ",(0,t.jsx)(n.code,{children:"envoy_ratelimit_*"})]}),"\n",(0,t.jsx)(n.li,{children:"Ensure client selectors match traffic patterns"}),"\n"]}),"\n",(0,t.jsxs)(n.p,{children:[(0,t.jsx)(n.strong,{children:"TLS errors"}),":"]}),"\n",(0,t.jsxs)(n.ul,{children:["\n",(0,t.jsx)(n.li,{children:"Verify certificate validity and SANs"}),"\n",(0,t.jsx)(n.li,{children:"Check BackendTLSPolicy configuration"}),"\n",(0,t.jsx)(n.li,{children:"Review Envoy logs for TLS handshake errors"}),"\n"]}),"\n",(0,t.jsx)(n.h2,{id:"extensibility-1",children:"Extensibility"}),"\n",(0,t.jsx)(n.h3,{id:"wasm-filters",children:"WASM Filters"}),"\n",(0,t.jsx)(n.p,{children:"Extend Envoy with WebAssembly filters:"}),"\n",(0,t.jsx)(n.pre,{children:(0,t.jsx)(n.code,{className:"language-yaml",children:'apiVersion: gateway.envoyproxy.io/v1alpha1\nkind: EnvoyPatchPolicy\nmetadata:\n  name: wasm-filter\n  namespace: tenant\nspec:\n  targetRef:\n    group: gateway.networking.k8s.io\n    kind: HTTPRoute\n    name: example-app\n  type: JSONPatch\n  jsonPatches:\n    - type: "type.googleapis.com/envoy.config.listener.v3.Listener"\n      name: listener-patch\n      operation:\n        op: add\n        path: "/filter_chains/0/filters/0/typed_config/http_filters/0"\n        value:\n          name: envoy.filters.http.wasm\n          typed_config:\n            "@type": type.googleapis.com/envoy.extensions.filters.http.wasm.v3.Wasm\n            config:\n              vm_config:\n                runtime: "envoy.wasm.runtime.v8"\n                code:\n                  remote:\n                    http_uri:\n                      uri: "https://example.com/filter.wasm"\n                      cluster: filter-server\n                      timeout: 10s\n'})}),"\n",(0,t.jsx)(n.h3,{id:"external-processors",children:"External Processors"}),"\n",(0,t.jsx)(n.p,{children:"Integrate external processing services:"}),"\n",(0,t.jsx)(n.pre,{children:(0,t.jsx)(n.code,{className:"language-yaml",children:"apiVersion: gateway.envoyproxy.io/v1alpha1\nkind: EnvoyExtensionPolicy\nmetadata:\n  name: ext-proc\n  namespace: tenant\nspec:\n  targetRef:\n    group: gateway.networking.k8s.io\n    kind: HTTPRoute\n    name: example-app\n  extProc:\n    backendRef:\n      name: ext-proc-service\n      port: 9002\n    processingMode:\n      requestHeaderMode: SEND\n      responseHeaderMode: SEND\n    messageTimeout: 200ms\n"})}),"\n",(0,t.jsx)(n.h2,{id:"further-reading",children:"Further Reading"}),"\n",(0,t.jsxs)(n.ul,{children:["\n",(0,t.jsx)(n.li,{children:(0,t.jsx)(n.a,{href:"https://gateway.envoyproxy.io/",children:"Envoy Gateway Official Documentation"})}),"\n",(0,t.jsx)(n.li,{children:(0,t.jsx)(n.a,{href:"https://gateway.envoyproxy.io/latest/tasks/",children:"Envoy Gateway Tasks"})}),"\n",(0,t.jsx)(n.li,{children:(0,t.jsx)(n.a,{href:"https://www.envoyproxy.io/docs",children:"Envoy Proxy Documentation"})}),"\n",(0,t.jsx)(n.li,{children:(0,t.jsx)(n.a,{href:"https://www.envoyproxy.io/docs/envoy/latest/configuration/configuration",children:"Envoy Proxy Configuration Reference"})}),"\n",(0,t.jsx)(n.li,{children:(0,t.jsx)(n.a,{href:"https://www.envoyproxy.io/docs/envoy/latest/api-docs/xds_protocol",children:"xDS Protocol"})}),"\n"]})]})}function p(e={}){const{wrapper:n}={...(0,s.R)(),...e.components};return n?(0,t.jsx)(n,{...e,children:(0,t.jsx)(h,{...e})}):h(e)}},8453(e,n,i){i.d(n,{R:()=>r,x:()=>o});var a=i(6540);const t={},s=a.createContext(t);function r(e){const n=a.useContext(s);return a.useMemo(function(){return"function"==typeof e?e(n):{...n,...e}},[n,e])}function o(e){let n;return n=e.disableParentContext?"function"==typeof e.components?e.components(t):e.components||t:r(e.components),a.createElement(s.Provider,{value:n},e.children)}}}]);