"use strict";(globalThis.webpackChunkhome=globalThis.webpackChunkhome||[]).push([[2554],{5877(e,n,o){o.r(n),o.d(n,{assets:()=>c,contentTitle:()=>s,default:()=>p,frontMatter:()=>a,metadata:()=>i,toc:()=>d});const i=JSON.parse('{"id":"xks/developer-guide/api-migrations","title":"API migrations","description":"In Kubernetes API:s get continuously upgraded and deprecated.","source":"@site/docs/xks/developer-guide/api-migrations.md","sourceDirName":"xks/developer-guide","slug":"/xks/developer-guide/api-migrations","permalink":"/docs/xks/developer-guide/api-migrations","draft":false,"unlisted":false,"editUrl":"https://github.com/xenitab/xenitab.github.io/edit/main/docs/xks/developer-guide/api-migrations.md","tags":[],"version":"current","frontMatter":{"id":"api-migrations","title":"API migrations"},"sidebar":"docs","previous":{"title":"Introduction","permalink":"/docs/xks/developer-guide/introduction"},"next":{"title":"Secrets Management","permalink":"/docs/xks/developer-guide/secrets-management"}}');var t=o(4848),r=o(8453);const a={id:"api-migrations",title:"API migrations"},s=void 0,c={},d=[{value:"Upgrading to Kubernetes 1.25",id:"upgrading-to-kubernetes-125",level:2},{value:"CronJob",id:"cronjob",level:3},{value:"HorizontalPodAutoscaler",id:"horizontalpodautoscaler",level:3},{value:"PodDisruptionBudget",id:"poddisruptionbudget",level:3},{value:"PodSecurityPolicy",id:"podsecuritypolicy",level:3},{value:"Patching",id:"patching",level:3},{value:"General API changes",id:"general-api-changes",level:2},{value:"SecretProviderClass v1alpha1 to v1",id:"secretproviderclass-v1alpha1-to-v1",level:3},{value:"Flux sourcecontroller v1beta1 to v1beta2",id:"flux-sourcecontroller-v1beta1-to-v1beta2",level:3}];function l(e){const n={a:"a",code:"code",h2:"h2",h3:"h3",p:"p",pre:"pre",...(0,r.R)(),...e.components};return(0,t.jsxs)(t.Fragment,{children:[(0,t.jsxs)(n.p,{children:["In Kubernetes API",":s"," get continuously upgraded and deprecated.\nAs a part of XKF we are in charge of upgrading the applications but it's up to you as a developer to upgrade the\nresources if you are utilizing them. We will of course inform you when it's time and summarize what needs to be done."]}),"\n",(0,t.jsx)(n.p,{children:"This page is about sharing that information."}),"\n",(0,t.jsx)(n.h2,{id:"upgrading-to-kubernetes-125",children:"Upgrading to Kubernetes 1.25"}),"\n",(0,t.jsx)(n.h3,{id:"cronjob",children:"CronJob"}),"\n",(0,t.jsxs)(n.p,{children:["CronJob ",(0,t.jsx)(n.code,{children:"apiVersion"})," is moved from ",(0,t.jsx)(n.code,{children:"batch/v1beta1"})," to ",(0,t.jsx)(n.code,{children:"batch/v1"}),".\nThe only thing you need to do is to change the API version."]}),"\n",(0,t.jsx)(n.p,{children:"From:"}),"\n",(0,t.jsx)(n.pre,{children:(0,t.jsx)(n.code,{className:"language-yaml",children:"apiVersion: batch/v1beta1\nkind: CronJob\nmetadata:\n  name: foo\n"})}),"\n",(0,t.jsx)(n.p,{children:"To:"}),"\n",(0,t.jsx)(n.pre,{children:(0,t.jsx)(n.code,{className:"language-yaml",children:"apiVersion: batch/v1\nkind: CronJob\nmetadata:\n  name: foo\n"})}),"\n",(0,t.jsx)(n.h3,{id:"horizontalpodautoscaler",children:"HorizontalPodAutoscaler"}),"\n",(0,t.jsxs)(n.p,{children:["HorizontalPodAutoscaler ",(0,t.jsx)(n.code,{children:"apiVersion"})," is moved from ",(0,t.jsx)(n.code,{children:"autoscaling/v2beta1"})," to ",(0,t.jsx)(n.code,{children:"autoscaling/v2"}),"."]}),"\n",(0,t.jsxs)(n.p,{children:["Changes include the ",(0,t.jsx)(n.code,{children:"apiVersion"})," but there's also changes to how ",(0,t.jsx)(n.code,{children:"targetAverageUtilization"})," is used. See example below."]}),"\n",(0,t.jsx)(n.p,{children:"From:"}),"\n",(0,t.jsx)(n.pre,{children:(0,t.jsx)(n.code,{className:"language-yaml",children:"apiVersion: autoscaling/v2beta2\nkind: HorizontalPodAutoscaler\nmetadata:\n  name: foo\nspec:\n  metrics:\n    - type: Resource\n      resource:\n        name: cpu\n        targetAverageUtilization: 50\n\n    - type: Resource\n      resource:\n        name: memory\n        targetAverageUtilization: 50\n"})}),"\n",(0,t.jsx)(n.p,{children:"To:"}),"\n",(0,t.jsx)(n.pre,{children:(0,t.jsx)(n.code,{className:"language-yaml",children:"apiVersion: autoscaling/v2\nkind: HorizontalPodAutoscaler\nmetadata:\n  name: foo\nspec:\n  metrics:\n    - type: Resource\n      resource:\n        name: cpu\n        target:\n          type: Utilization\n          averageUtilization: 50\n    - type: Resource\n      resource:\n        name: memory\n        target:\n          type: Utilization\n          averageUtilization: 50\n"})}),"\n",(0,t.jsx)(n.h3,{id:"poddisruptionbudget",children:"PodDisruptionBudget"}),"\n",(0,t.jsxs)(n.p,{children:["PodDisruptionBudget ",(0,t.jsx)(n.code,{children:"apiVersion"})," is moved from ",(0,t.jsx)(n.code,{children:"policy/v1beta1"})," to ",(0,t.jsx)(n.code,{children:"policy/v1"}),".\nThe main thing you need to do is to change ",(0,t.jsx)(n.code,{children:"apiVersion"}),"."]}),"\n",(0,t.jsx)(n.p,{children:"From:"}),"\n",(0,t.jsx)(n.pre,{children:(0,t.jsx)(n.code,{className:"language-yaml",children:"apiVersion: policy/v1beta1\nkind: PodDisruptionBudget\nmetadata:\n  name: foo\n"})}),"\n",(0,t.jsx)(n.p,{children:"To:"}),"\n",(0,t.jsx)(n.pre,{children:(0,t.jsx)(n.code,{className:"language-yaml",children:"apiVersion: policy/v1\nkind: PodDisruptionBudget\nmetadata:\n  name: foo\n"})}),"\n",(0,t.jsxs)(n.p,{children:["Another important change is that in ",(0,t.jsx)(n.code,{children:"policy/v1"})," an empty ",(0,t.jsx)(n.code,{children:"spec.selector {}"})," selects all pods in the namespace, when the previous ",(0,t.jsx)(n.code,{children:"policy/v1beta1"})," did not select any pods."]}),"\n",(0,t.jsx)(n.h3,{id:"podsecuritypolicy",children:"PodSecurityPolicy"}),"\n",(0,t.jsxs)(n.p,{children:["PodSecurityPolicy in the policy/v1beta1 API version will no longer be served in v1.25, and the PodSecurityPolicy admission controller will be removed. More information can be found in the ",(0,t.jsx)(n.a,{href:"https://kubernetes.io/docs/reference/using-api/deprecation-guide/#psp-v125",children:"Kubernetes deprecation guide"}),"."]}),"\n",(0,t.jsx)(n.p,{children:"This is not something that we use in XKF, but it is good to know."}),"\n",(0,t.jsx)(n.h3,{id:"patching",children:"Patching"}),"\n",(0,t.jsxs)(n.p,{children:["If you have any kustomizations patching in different values between environments, or similar, these will also have to be changed to match the new ",(0,t.jsx)(n.code,{children:"apiVersion"}),"."]}),"\n",(0,t.jsx)(n.p,{children:"From:"}),"\n",(0,t.jsx)(n.pre,{children:(0,t.jsx)(n.code,{className:"language-yaml",children:"- path: pdb-patch.yaml\n  target:\n    group: policy\n    version: v1beta1\n    kind: PodDisruptionBudget\n    name: app\n"})}),"\n",(0,t.jsx)(n.p,{children:"To:"}),"\n",(0,t.jsx)(n.pre,{children:(0,t.jsx)(n.code,{className:"language-yaml",children:"- path: pdb-patch.yaml\n  target:\n    group: policy\n    version: v1\n    kind: PodDisruptionBudget\n    name: app\n"})}),"\n",(0,t.jsx)(n.h2,{id:"general-api-changes",children:"General API changes"}),"\n",(0,t.jsx)(n.h3,{id:"secretproviderclass-v1alpha1-to-v1",children:"SecretProviderClass v1alpha1 to v1"}),"\n",(0,t.jsxs)(n.p,{children:["SecretProviderClass ",(0,t.jsx)(n.code,{children:"apiVersion"})," is moved from ",(0,t.jsx)(n.code,{children:"secrets-store.csi.x-k8s.io/v1alpha1"})," to ",(0,t.jsx)(n.code,{children:"secrets-store.csi.x-k8s.io/v1"}),"."]}),"\n",(0,t.jsx)(n.p,{children:"The only thing you need to do is to change is the API version."}),"\n",(0,t.jsx)(n.p,{children:"From:"}),"\n",(0,t.jsx)(n.pre,{children:(0,t.jsx)(n.code,{className:"language-yaml",children:'apiVersion: secrets-store.csi.x-k8s.io/v1alpha1\nkind: SecretProviderClass\nmetadata:\n  name: foo\nspec:\n  provider: <provider>\n  parameters:\n    objects: |\n      - objectName: "bar"\n        objectType: "<type>"\n      - objectName: "baz"\n        objectType: "<type>"\n'})}),"\n",(0,t.jsx)(n.p,{children:"To:"}),"\n",(0,t.jsx)(n.pre,{children:(0,t.jsx)(n.code,{className:"language-yaml",children:'apiVersion: secrets-store.csi.x-k8s.io/v1\nkind: SecretProviderClass\nmetadata:\n  name: foo\nspec:\n  provider: <provider>\n  parameters:\n    objects: |\n      - objectName: "bar"\n        objectType: "<type>"\n      - objectName: "baz"\n        objectType: "<type>"\n'})}),"\n",(0,t.jsx)(n.h3,{id:"flux-sourcecontroller-v1beta1-to-v1beta2",children:"Flux sourcecontroller v1beta1 to v1beta2"}),"\n",(0,t.jsxs)(n.p,{children:["The only thing that you need to change when moving ",(0,t.jsx)(n.code,{children:"source.toolkit.fluxcd.io"})," from ",(0,t.jsx)(n.code,{children:"source.toolkit.fluxcd.io/v1beta1"}),"to ",(0,t.jsx)(n.code,{children:"source.toolkit.fluxcd.io/v1beta2"})," is the API version."]}),"\n",(0,t.jsx)(n.p,{children:"In XKF we handle the upgrade of your default GitRepository, but if you have created some other source object you will need to update it on your own."}),"\n",(0,t.jsxs)(n.p,{children:["Note that other Flux controllers (e.g. ",(0,t.jsx)(n.code,{children:"kustomization.toolkit.fluxcd.io"})," and ",(0,t.jsx)(n.code,{children:"notification.toolkit.fluxcd.io"}),") remain at ",(0,t.jsx)(n.code,{children:"v1beta1"}),"."]})]})}function p(e={}){const{wrapper:n}={...(0,r.R)(),...e.components};return n?(0,t.jsx)(n,{...e,children:(0,t.jsx)(l,{...e})}):l(e)}},8453(e,n,o){o.d(n,{R:()=>a,x:()=>s});var i=o(6540);const t={},r=i.createContext(t);function a(e){const n=i.useContext(r);return i.useMemo(function(){return"function"==typeof e?e(n):{...n,...e}},[n,e])}function s(e){let n;return n=e.disableParentContext?"function"==typeof e.components?e.components(t):e.components||t:a(e.components),i.createElement(r.Provider,{value:n},e.children)}}}]);