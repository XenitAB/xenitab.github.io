"use strict";(globalThis.webpackChunkhome=globalThis.webpackChunkhome||[]).push([[6648],{5671(e,n,r){r.r(n),r.d(n,{assets:()=>u,contentTitle:()=>a,default:()=>d,frontMatter:()=>i,metadata:()=>t,toc:()=>l});const t=JSON.parse('{"id":"xks/operator-guide/github","title":"XKF on Github","description":"As a XKF user you can use both Azure DevOps and GitHub to store","source":"@site/docs/xks/operator-guide/github.md","sourceDirName":"xks/operator-guide","slug":"/xks/operator-guide/github","permalink":"/docs/xks/operator-guide/github","draft":false,"unlisted":false,"editUrl":"https://github.com/xenitab/xenitab.github.io/edit/main/docs/xks/operator-guide/github.md","tags":[],"version":"current","frontMatter":{"id":"github","title":"XKF on Github"},"sidebar":"docs","previous":{"title":"AWS azure-devops","permalink":"/docs/xks/operator-guide/aws-azdo"},"next":{"title":"CVE Information","permalink":"/docs/xks/operator-guide/cve"}}');var o=r(4848),s=r(8453);const i={id:"github",title:"XKF on Github"},a=void 0,u={},l=[{value:"Terraform",id:"terraform",level:2},{value:"Workflow",id:"workflow",level:3},{value:"Self-hosted runners",id:"self-hosted-runners",level:3},{value:"Azure Service Principal",id:"azure-service-principal",level:3}];function c(e){const n={a:"a",code:"code",em:"em",h2:"h2",h3:"h3",p:"p",pre:"pre",strong:"strong",...(0,s.R)(),...e.components};return(0,o.jsxs)(o.Fragment,{children:[(0,o.jsx)(n.p,{children:"As a XKF user you can use both Azure DevOps and GitHub to store\nyour Terraform and GitOps repositories."}),"\n",(0,o.jsx)(n.p,{children:"In this document we will go through how to use XKF on GitHub focusing\non Infrastructure As Code (IAC) using Terraform."}),"\n",(0,o.jsx)(n.h2,{id:"terraform",children:"Terraform"}),"\n",(0,o.jsx)(n.p,{children:"How to run Terraform plan and apply through a GitHub action workflow."}),"\n",(0,o.jsx)(n.h3,{id:"workflow",children:"Workflow"}),"\n",(0,o.jsxs)(n.p,{children:["Just like in the Azure DevOps case we have created a ",(0,o.jsx)(n.a,{href:"https://github.com/XenitAB/azure-devops-templates/terraform-docker-github/README.md",children:"basic pipeline"})," for easy use."]}),"\n",(0,o.jsx)(n.p,{children:"Below you can find an example pipeline that uses the Github Actions workflow.\nRead further down to see how to create the secrets needed to run the pipeline."}),"\n",(0,o.jsxs)(n.p,{children:["You should store this GitHub action in your Terraform repository under ",(0,o.jsx)(n.code,{children:".github/workflows/name.yaml"})]}),"\n",(0,o.jsx)(n.pre,{children:(0,o.jsx)(n.code,{className:"language-.github/workflows/core.yaml",children:'name: terraform_core\n\non:\n  push:\n    branches:\n      - main\n    paths:\n      - core/**\n  pull_request:\n    paths:\n      - core/**\n  workflow_dispatch:\n    inputs:\n      OPA_BLAST_RADIUS:\n        description: OPA Blast Radius\n        required: true\n        default: "50"\n\njobs:\n  terraform:\n    uses: xenitab/azure-devops-templates/.github/workflows/terraform-docker.yaml@2021.10.1\n    with:\n      DIR: core\n      runs-on: \'["self-hosted", "linux"]\' # If you do not want to use the default ubuntu-latest\n      ENVIRONMENTS: |\n        {\n          "environments":[\n            {"name":"dev"},\n            {"name":"qa"},\n            {"name":"prod"}\n          ]\n        }\n    secrets:\n      AZURE_CREDENTIALS_DEV: ${{ secrets.AZURE_CREDENTIALS_DEV }}\n      AZURE_CREDENTIALS_QA: ${{ secrets.AZURE_CREDENTIALS_QA }}\n      AZURE_CREDENTIALS_PROD: ${{ secrets.AZURE_CREDENTIALS_PROD }}\n'})}),"\n",(0,o.jsx)(n.h3,{id:"self-hosted-runners",children:"Self-hosted runners"}),"\n",(0,o.jsx)(n.p,{children:"It is currently not possible to use self-hosted runners hosted in GitHub organization X while calling on workflows in GitHub organization Y."}),"\n",(0,o.jsxs)(n.p,{children:["To be able to use self-hosted runners you have to ",(0,o.jsx)(n.strong,{children:"import (not fork)"})," the repository to organization X the ",(0,o.jsx)(n.a,{href:"https://github.com/XenitAB/azure-devops-templates",children:"workflow repository"}),"\nand make it public. If you do not do this private repositories located in organization X will not be able to find the workflows."]}),"\n",(0,o.jsx)(n.h3,{id:"azure-service-principal",children:"Azure Service Principal"}),"\n",(0,o.jsxs)(n.p,{children:["Create a Service Principal(SP) with the access that Terraform requires to perform all the tasks you want.\nYou can read more about SP creation in our ",(0,o.jsx)(n.a,{href:"/docs/xks/operator-guide/getting-started",children:"getting started guide"})]}),"\n",(0,o.jsxs)(n.p,{children:["The workflow is using ",(0,o.jsx)(n.a,{href:"https://github.com/marketplace/actions/azure-login#configure-deployment-credentials",children:"Azure Login GitHub Action"}),"\nto login to Azure. When uploading your SP to GitHub make sure to follow the formatting in the examples."]}),"\n",(0,o.jsxs)(n.p,{children:["This is to prevent unnecessary masking of ",(0,o.jsx)(n.code,{children:"{ }"})," in your logs which are in dictionary form."]}),"\n",(0,o.jsxs)(n.p,{children:[(0,o.jsx)(n.strong,{children:"For example, do"}),":"]}),"\n",(0,o.jsx)(n.pre,{children:(0,o.jsx)(n.code,{className:"language-.json",children:'{"clientId": "00000000-0000-0000-0000-000000000000",\n  "clientSecret": "super-duper-secret-value",\n  "subscriptionId": "00000000-0000-0000-0000-000000000000",\n  "tenantId": "00000000-0000-0000-0000-000000000000"}\n'})}),"\n",(0,o.jsxs)(n.p,{children:[(0,o.jsx)(n.strong,{children:"instead of"}),":"]}),"\n",(0,o.jsx)(n.pre,{children:(0,o.jsx)(n.code,{className:"language-.json",children:'{\n  "clientId": "00000000-0000-0000-0000-000000000000",\n  "clientSecret": "super-duper-secret-value",\n  "subscriptionId": "00000000-0000-0000-0000-000000000000",\n  "tenantId": "00000000-0000-0000-0000-000000000000"\n}\n'})}),"\n",(0,o.jsxs)(n.p,{children:["Upload the entire JSON as your GitHub secret.\nThe workflow uses one secret per environment and we recommend that you follow our naming standard.\nThe secret name the workflow uses is ",(0,o.jsxs)(n.strong,{children:["AZURE",(0,o.jsx)(n.em,{children:"CREDENTIALS"}),"<ENV>"]}),", for example ",(0,o.jsx)(n.strong,{children:"AZURE_CREDENTIALS_DEV"}),"."]}),"\n",(0,o.jsxs)(n.p,{children:["To upload the secret to GitHub you can use the GitHub UI or you can use the ",(0,o.jsx)(n.a,{href:"https://github.com/cli/cli",children:"GitHub CLI"})," to upload secrets to GitHub."]}),"\n",(0,o.jsx)(n.p,{children:"Assuming that you are storing the SP JSON data in a file you could do:"}),"\n",(0,o.jsx)(n.pre,{children:(0,o.jsx)(n.code,{className:"language-shell",children:"gh secret -R ORG/xks-terraform set AZURE_CREDENTIALS_DEV < dev-secrets.json\ngh secret -R ORG/xks-terraform set AZURE_CREDENTIALS_QA < qa-secrets.json\ngh secret -R ORG/xks-terraform set AZURE_CREDENTIALS_PROD < prod-secrets.json\n"})})]})}function d(e={}){const{wrapper:n}={...(0,s.R)(),...e.components};return n?(0,o.jsx)(n,{...e,children:(0,o.jsx)(c,{...e})}):c(e)}},8453(e,n,r){r.d(n,{R:()=>i,x:()=>a});var t=r(6540);const o={},s=t.createContext(o);function i(e){const n=t.useContext(s);return t.useMemo(function(){return"function"==typeof e?e(n):{...n,...e}},[n,e])}function a(e){let n;return n=e.disableParentContext?"function"==typeof e.components?e.components(o):e.components||o:i(e.components),t.createElement(s.Provider,{value:n},e.children)}}}]);