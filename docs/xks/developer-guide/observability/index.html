<!doctype html>
<html lang="en" dir="ltr" class="docs-wrapper plugin-docs plugin-id-default docs-version-current docs-doc-page docs-doc-id-xks/developer-guide/observability" data-has-hydrated="false">
<head>
<meta charset="UTF-8">
<meta name="generator" content="Docusaurus v3.9.2">
<title data-rh="true">Observability | Xenit</title><meta data-rh="true" name="viewport" content="width=device-width,initial-scale=1"><meta data-rh="true" name="twitter:card" content="summary_large_image"><meta data-rh="true" property="og:image" content="http://xenitab.github.io/img/Xenit_logo_Svart.png"><meta data-rh="true" name="twitter:image" content="http://xenitab.github.io/img/Xenit_logo_Svart.png"><meta data-rh="true" property="og:url" content="http://xenitab.github.io/docs/xks/developer-guide/observability"><meta data-rh="true" property="og:locale" content="en"><meta data-rh="true" name="docusaurus_locale" content="en"><meta data-rh="true" name="docsearch:language" content="en"><meta data-rh="true" name="docusaurus_version" content="current"><meta data-rh="true" name="docusaurus_tag" content="docs-default-current"><meta data-rh="true" name="docsearch:version" content="current"><meta data-rh="true" name="docsearch:docusaurus_tag" content="docs-default-current"><meta data-rh="true" property="og:title" content="Observability | Xenit"><meta data-rh="true" name="description" content="What is observability?"><meta data-rh="true" property="og:description" content="What is observability?"><link data-rh="true" rel="icon" href="/img/favicon.ico"><link data-rh="true" rel="canonical" href="http://xenitab.github.io/docs/xks/developer-guide/observability"><link data-rh="true" rel="alternate" href="http://xenitab.github.io/docs/xks/developer-guide/observability" hreflang="en"><link data-rh="true" rel="alternate" href="http://xenitab.github.io/docs/xks/developer-guide/observability" hreflang="x-default"><script data-rh="true" type="application/ld+json">{"@context":"https://schema.org","@type":"BreadcrumbList","itemListElement":[{"@type":"ListItem","position":1,"name":"Observability","item":"http://xenitab.github.io/docs/xks/developer-guide/observability"}]}</script><link rel="alternate" type="application/rss+xml" href="/blog/rss.xml" title="Xenit RSS Feed">
<link rel="alternate" type="application/atom+xml" href="/blog/atom.xml" title="Xenit Atom Feed">

<link rel="preconnect" href="https://www.google-analytics.com">
<link rel="preconnect" href="https://www.googletagmanager.com">
<script async src="https://www.googletagmanager.com/gtag/js?id=GTM-5K3TQ3K"></script>
<script>function gtag(){dataLayer.push(arguments)}window.dataLayer=window.dataLayer||[],gtag("js",new Date),gtag("config","GTM-5K3TQ3K",{anonymize_ip:!0})</script><link rel="stylesheet" href="/assets/css/styles.835dd407.css">
<script src="/assets/js/runtime~main.b2f95f14.js" defer="defer"></script>
<script src="/assets/js/main.50de46a3.js" defer="defer"></script>
</head>
<body class="navigation-with-keyboard">
<svg style="display: none;"><defs>
<symbol id="theme-svg-external-link" viewBox="0 0 24 24"><path fill="currentColor" d="M21 13v10h-21v-19h12v2h-10v15h17v-8h2zm3-12h-10.988l4.035 4-6.977 7.07 2.828 2.828 6.977-7.07 4.125 4.172v-11z"/></symbol>
</defs></svg>
<script>!function(){var t=function(){try{return new URLSearchParams(window.location.search).get("docusaurus-theme")}catch(t){}}()||function(){try{return window.localStorage.getItem("theme")}catch(t){}}();document.documentElement.setAttribute("data-theme",t||"light"),document.documentElement.setAttribute("data-theme-choice",t||"light")}(),function(){try{const c=new URLSearchParams(window.location.search).entries();for(var[t,e]of c)if(t.startsWith("docusaurus-data-")){var a=t.replace("docusaurus-data-","data-");document.documentElement.setAttribute(a,e)}}catch(t){}}()</script><div id="__docusaurus"><div role="region" aria-label="Skip to main content"><a class="skipToContent_fXgn" href="#__docusaurus_skipToContent_fallback">Skip to main content</a></div><nav aria-label="Main" class="theme-layout-navbar navbar navbar--fixed-top"><div class="navbar__inner"><div class="theme-layout-navbar-left navbar__items"><button aria-label="Toggle navigation bar" aria-expanded="false" class="navbar__toggle clean-btn" type="button"><svg width="30" height="30" viewBox="0 0 30 30" aria-hidden="true"><path stroke="currentColor" stroke-linecap="round" stroke-miterlimit="10" stroke-width="2" d="M4 7h22M4 15h22M4 23h22"></path></svg></button><a class="navbar__brand" href="/"><div class="navbar__logo"><img src="/img/Xenit_logo_Svart.png" alt="Xenit logo" class="themedComponent_mlkZ themedComponent--light_NVdE"><img src="/img/Xenit_logo_Vit.png" alt="Xenit logo" class="themedComponent_mlkZ themedComponent--dark_xIcU"></div></a></div><div class="theme-layout-navbar-right navbar__items navbar__items--right"><a aria-current="page" class="navbar__item navbar__link navbar__link--active" href="/docs/">Docs</a><a class="navbar__item navbar__link" href="/blog/">Blog</a><a href="https://github.com/XenitAB" target="_blank" rel="noopener noreferrer" class="navbar__item navbar__link">GitHub<svg width="13.5" height="13.5" aria-label="(opens in new tab)" class="iconExternalLink_nPIU"><use href="#theme-svg-external-link"></use></svg></a><div class="toggle_vylO colorModeToggle_DEke"><button class="clean-btn toggleButton_gllP toggleButtonDisabled_aARS" type="button" disabled="" title="system mode" aria-label="Switch between dark and light mode (currently system mode)"><svg viewBox="0 0 24 24" width="24" height="24" aria-hidden="true" class="toggleIcon_g3eP lightToggleIcon_pyhR"><path fill="currentColor" d="M12,9c1.65,0,3,1.35,3,3s-1.35,3-3,3s-3-1.35-3-3S10.35,9,12,9 M12,7c-2.76,0-5,2.24-5,5s2.24,5,5,5s5-2.24,5-5 S14.76,7,12,7L12,7z M2,13l2,0c0.55,0,1-0.45,1-1s-0.45-1-1-1l-2,0c-0.55,0-1,0.45-1,1S1.45,13,2,13z M20,13l2,0c0.55,0,1-0.45,1-1 s-0.45-1-1-1l-2,0c-0.55,0-1,0.45-1,1S19.45,13,20,13z M11,2v2c0,0.55,0.45,1,1,1s1-0.45,1-1V2c0-0.55-0.45-1-1-1S11,1.45,11,2z M11,20v2c0,0.55,0.45,1,1,1s1-0.45,1-1v-2c0-0.55-0.45-1-1-1C11.45,19,11,19.45,11,20z M5.99,4.58c-0.39-0.39-1.03-0.39-1.41,0 c-0.39,0.39-0.39,1.03,0,1.41l1.06,1.06c0.39,0.39,1.03,0.39,1.41,0s0.39-1.03,0-1.41L5.99,4.58z M18.36,16.95 c-0.39-0.39-1.03-0.39-1.41,0c-0.39,0.39-0.39,1.03,0,1.41l1.06,1.06c0.39,0.39,1.03,0.39,1.41,0c0.39-0.39,0.39-1.03,0-1.41 L18.36,16.95z M19.42,5.99c0.39-0.39,0.39-1.03,0-1.41c-0.39-0.39-1.03-0.39-1.41,0l-1.06,1.06c-0.39,0.39-0.39,1.03,0,1.41 s1.03,0.39,1.41,0L19.42,5.99z M7.05,18.36c0.39-0.39,0.39-1.03,0-1.41c-0.39-0.39-1.03-0.39-1.41,0l-1.06,1.06 c-0.39,0.39-0.39,1.03,0,1.41s1.03,0.39,1.41,0L7.05,18.36z"></path></svg><svg viewBox="0 0 24 24" width="24" height="24" aria-hidden="true" class="toggleIcon_g3eP darkToggleIcon_wfgR"><path fill="currentColor" d="M9.37,5.51C9.19,6.15,9.1,6.82,9.1,7.5c0,4.08,3.32,7.4,7.4,7.4c0.68,0,1.35-0.09,1.99-0.27C17.45,17.19,14.93,19,12,19 c-3.86,0-7-3.14-7-7C5,9.07,6.81,6.55,9.37,5.51z M12,3c-4.97,0-9,4.03-9,9s4.03,9,9,9s9-4.03,9-9c0-0.46-0.04-0.92-0.1-1.36 c-0.98,1.37-2.58,2.26-4.4,2.26c-2.98,0-5.4-2.42-5.4-5.4c0-1.81,0.89-3.42,2.26-4.4C12.92,3.04,12.46,3,12,3L12,3z"></path></svg><svg viewBox="0 0 24 24" width="24" height="24" aria-hidden="true" class="toggleIcon_g3eP systemToggleIcon_QzmC"><path fill="currentColor" d="m12 21c4.971 0 9-4.029 9-9s-4.029-9-9-9-9 4.029-9 9 4.029 9 9 9zm4.95-13.95c1.313 1.313 2.05 3.093 2.05 4.95s-0.738 3.637-2.05 4.95c-1.313 1.313-3.093 2.05-4.95 2.05v-14c1.857 0 3.637 0.737 4.95 2.05z"></path></svg></button></div><div class="navbarSearchContainer_Bca1"><div class="dsla-search-wrapper"><div class="dsla-search-field" data-tags="default,docs-default-current"></div></div></div></div></div><div role="presentation" class="navbar-sidebar__backdrop"></div></nav><div id="__docusaurus_skipToContent_fallback" class="theme-layout-main main-wrapper mainWrapper_z2l0"><div class="docsWrapper_hBAB"><button aria-label="Scroll back to top" class="clean-btn theme-back-to-top-button backToTopButton_sjWU" type="button"></button><div class="docRoot_UBD9"><aside class="theme-doc-sidebar-container docSidebarContainer_YfHR"><div class="sidebarViewport_aRkj"><div class="sidebar_njMd"><nav aria-label="Docs sidebar" class="menu thin-scrollbar menu_SIkG"><ul class="theme-doc-sidebar-menu menu__list"><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-1 menu__list-item"><a class="menu__link" href="/docs/"><span title="Introduction" class="linkLabel_WmDU">Introduction</span></a></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-1 menu__list-item"><div class="menu__list-item-collapsible"><a class="categoryLink_byQd menu__link menu__link--sublist menu__link--sublist-caret menu__link--active" role="button" aria-expanded="true" href="/docs/xks/"><span title="Xenit Kubernetes Service" class="categoryLinkLabel_W154">Xenit Kubernetes Service</span></a></div><ul class="menu__list"><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class="menu__link" tabindex="0" href="/docs/xks/"><span title="Overview" class="linkLabel_WmDU">Overview</span></a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class="menu__link" tabindex="0" href="/docs/xks/architecture-and-design"><span title="Architecture and design" class="linkLabel_WmDU">Architecture and design</span></a></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-2 menu__list-item"><div class="menu__list-item-collapsible"><a class="categoryLink_byQd menu__link menu__link--sublist menu__link--sublist-caret menu__link--active" role="button" aria-expanded="true" tabindex="0" href="/docs/xks/developer-guide/introduction"><span title="Developer Guide" class="categoryLinkLabel_W154">Developer Guide</span></a></div><ul class="menu__list"><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-3 menu__list-item"><a class="menu__link" tabindex="0" href="/docs/xks/developer-guide/introduction"><span title="Introduction" class="linkLabel_WmDU">Introduction</span></a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-3 menu__list-item"><a class="menu__link" tabindex="0" href="/docs/xks/developer-guide/api-migrations"><span title="API migrations" class="linkLabel_WmDU">API migrations</span></a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-3 menu__list-item"><a class="menu__link" tabindex="0" href="/docs/xks/developer-guide/secrets-management"><span title="Secrets Management" class="linkLabel_WmDU">Secrets Management</span></a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-3 menu__list-item"><a class="menu__link" tabindex="0" href="/docs/xks/developer-guide/cloud-iam"><span title="Cloud IAM" class="linkLabel_WmDU">Cloud IAM</span></a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-3 menu__list-item"><a class="menu__link" tabindex="0" href="/docs/xks/developer-guide/container-security"><span title="Container Security" class="linkLabel_WmDU">Container Security</span></a></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-3 menu__list-item menu__list-item--collapsed"><div class="menu__list-item-collapsible"><a class="categoryLink_byQd menu__link menu__link--sublist menu__link--sublist-caret" role="button" aria-expanded="false" tabindex="0" href="/docs/xks/developer-guide/ci-cd/ci"><span title="CI/CD" class="categoryLinkLabel_W154">CI/CD</span></a></div></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-3 menu__list-item"><a class="menu__link" tabindex="0" href="/docs/xks/developer-guide/scheduling-scaling"><span title="Scheduling and Scaling" class="linkLabel_WmDU">Scheduling and Scaling</span></a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-3 menu__list-item"><a class="menu__link menu__link--active" aria-current="page" tabindex="0" href="/docs/xks/developer-guide/observability"><span title="Observability" class="linkLabel_WmDU">Observability</span></a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-3 menu__list-item"><a class="menu__link" tabindex="0" href="/docs/xks/developer-guide/networking"><span title="Networking" class="linkLabel_WmDU">Networking</span></a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-3 menu__list-item"><a class="menu__link" tabindex="0" href="/docs/xks/developer-guide/wsl2"><span title="Working with XKF from Windows" class="linkLabel_WmDU">Working with XKF from Windows</span></a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-3 menu__list-item"><a class="menu__link" tabindex="0" href="/docs/xks/developer-guide/reports"><span title="Reports" class="linkLabel_WmDU">Reports</span></a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-3 menu__list-item"><a class="menu__link" tabindex="0" href="/docs/xks/developer-guide/best-practices"><span title="Best Practices" class="linkLabel_WmDU">Best Practices</span></a></li></ul></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-2 menu__list-item menu__list-item--collapsed"><div class="menu__list-item-collapsible"><a class="categoryLink_byQd menu__link menu__link--sublist menu__link--sublist-caret" role="button" aria-expanded="false" tabindex="0" href="/docs/xks/operator-guide/"><span title="Operator Guide" class="categoryLinkLabel_W154">Operator Guide</span></a></div></li></ul></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-1 menu__list-item menu__list-item--collapsed"><div class="menu__list-item-collapsible"><a class="categoryLink_byQd menu__link menu__link--sublist menu__link--sublist-caret" role="button" aria-expanded="false" href="/docs/xenit-style-guide/containers"><span title="Xenit Style Guide" class="categoryLinkLabel_W154">Xenit Style Guide</span></a></div></li></ul></nav></div></div></aside><main class="docMainContainer_TBSr"><div class="container padding-top--md padding-bottom--lg"><div class="row"><div class="col docItemCol_VOVn"><div class="docItemContainer_Djhp"><article><nav class="theme-doc-breadcrumbs breadcrumbsContainer_Z_bl" aria-label="Breadcrumbs"><ul class="breadcrumbs"><li class="breadcrumbs__item"><a aria-label="Home page" class="breadcrumbs__link" href="/"><svg viewBox="0 0 24 24" class="breadcrumbHomeIcon_YNFT"><path d="M10 19v-5h4v5c0 .55.45 1 1 1h3c.55 0 1-.45 1-1v-7h1.7c.46 0 .68-.57.33-.87L12.67 3.6c-.38-.34-.96-.34-1.34 0l-8.36 7.53c-.34.3-.13.87.33.87H5v7c0 .55.45 1 1 1h3c.55 0 1-.45 1-1z" fill="currentColor"></path></svg></a></li><li class="breadcrumbs__item"><span class="breadcrumbs__link">Xenit Kubernetes Service</span></li><li class="breadcrumbs__item"><span class="breadcrumbs__link">Developer Guide</span></li><li class="breadcrumbs__item breadcrumbs__item--active"><span class="breadcrumbs__link">Observability</span></li></ul></nav><div class="tocCollapsible_ETCw theme-doc-toc-mobile tocMobile_ITEo"><button type="button" class="clean-btn tocCollapsibleButton_TO0P">On this page</button></div><div class="theme-doc-markdown markdown"><header><h1>Observability</h1></header><h2 class="anchor anchorTargetStickyNavbar_Vzrq" id="what-is-observability">What is observability?<a href="#what-is-observability" class="hash-link" aria-label="Direct link to What is observability?" title="Direct link to What is observability?" translate="no">​</a></h2>
<p>Within observability we normally talk about three pillars.</p>
<ul>
<li class="">metrics</li>
<li class="">logging</li>
<li class="">tracing</li>
</ul>
<p>Monitoring applications is an especially important feature when developing microservices
and something that all developers of microservices needs to focus on.</p>
<p>We currently support two solutions to gather observability data in XKF, <a href="https://www.datadoghq.com" target="_blank" rel="noopener noreferrer" class="">Datadog</a> and the <a href="https://opentelemetry.io/" target="_blank" rel="noopener noreferrer" class="">Opentelemetry</a> stack which is an open-source solution.</p>
<h2 class="anchor anchorTargetStickyNavbar_Vzrq" id="datadog">Datadog<a href="#datadog" class="hash-link" aria-label="Direct link to Datadog" title="Direct link to Datadog" translate="no">​</a></h2>
<p>When Datadog monitoring is used the <a href="https://github.com/DataDog/datadog-operator" target="_blank" rel="noopener noreferrer" class="">Datadog Operator</a> will be added to your cluster. On top of deploying a
Datadog agent to every node to collect metrics, logs, and traces it also adds the ability to create Datadog monitors from the cluster. The Datadog
agent handles all communication with the Datadog API meaning that individual applications do not have to deal with things such as authentication.</p>
<h3 class="anchor anchorTargetStickyNavbar_Vzrq" id="logging">Logging<a href="#logging" class="hash-link" aria-label="Direct link to Logging" title="Direct link to Logging" translate="no">​</a></h3>
<p>All logs written to <code>stdout</code> and <code>stderr</code> from applications in the tenant namespace will be collected by the Datadog agents. This means that no additional
configuration has to be done to the application, other than making sure the logs are written to the correct destination.
This means that <code>kubectl logs</code> and Datadog will display the same information.</p>
<p>Check the official <a href="https://docs.datadoghq.com/agent/kubernetes/log/?tab=daemonset" target="_blank" rel="noopener noreferrer" class="">Datadog Logging Documentation</a> for more detailed information.</p>
<h3 class="anchor anchorTargetStickyNavbar_Vzrq" id="metrics">Metrics<a href="#metrics" class="hash-link" aria-label="Direct link to Metrics" title="Direct link to Metrics" translate="no">​</a></h3>
<p>Datadog can collect Prometheus or OpenMetrics metrics exposed by your application.
In simple terms this means that the application needs to expose an endpoint which the Datadog agent can scrape to get the metrics.
All that is required is that the Pod contains annotations which tells Datadog where to find the metrics HTTP endpoint.</p>
<p>Given that your application is exposing metrics on port 8080 your pod should contain the following annotations.</p>
<div class="language-yaml codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#bfc7d5;--prism-background-color:#292d3e"><div class="codeBlockContent_QJqH"><pre tabindex="0" class="prism-code language-yaml codeBlock_bY9V thin-scrollbar" style="color:#bfc7d5;background-color:#292d3e"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#bfc7d5"><span class="token key atrule">annotations</span><span class="token punctuation" style="color:rgb(199, 146, 234)">:</span><span class="token plain"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">  </span><span class="token key atrule">ad.datadoghq.com/prometheus-example.instances</span><span class="token punctuation" style="color:rgb(199, 146, 234)">:</span><span class="token plain"> </span><span class="token punctuation" style="color:rgb(199, 146, 234)">|</span><span class="token scalar string" style="color:rgb(195, 232, 141)"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token scalar string" style="color:rgb(195, 232, 141)">    [</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token scalar string" style="color:rgb(195, 232, 141)">      {</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token scalar string" style="color:rgb(195, 232, 141)">        &quot;prometheus_url&quot;: &quot;http://%%host%%:8080/metrics&quot;</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token scalar string" style="color:rgb(195, 232, 141)">      }</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token scalar string" style="color:rgb(195, 232, 141)">    ]</span><br></span></code></pre></div></div>
<p>Check the official <a href="https://docs.datadoghq.com/agent/kubernetes/prometheus/" target="_blank" rel="noopener noreferrer" class="">Datadog Metrics Documentation</a> for more detailed information.</p>
<h3 class="anchor anchorTargetStickyNavbar_Vzrq" id="tracing">Tracing<a href="#tracing" class="hash-link" aria-label="Direct link to Tracing" title="Direct link to Tracing" translate="no">​</a></h3>
<p>Datadog tracing is done with Application Performance Monitoring (APM), which sends traces from an application to Datadog.
For traces to work the application needs to be configured with the language specific libraries.
Check the <a href="https://docs.datadoghq.com/tracing/setup_overview/" target="_blank" rel="noopener noreferrer" class="">Language Documentation</a>
for language specific instructions. Some of the languages that are supported are.</p>
<ul>
<li class="">Golang</li>
<li class="">C#</li>
<li class="">Java</li>
<li class="">Python</li>
</ul>
<p>Configure your Deployment with the <code>DD_AGENT_HOST</code> environment for the APM agent to know where to send the traces.</p>
<div class="language-deployment.yaml codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#bfc7d5;--prism-background-color:#292d3e"><div class="codeBlockContent_QJqH"><pre tabindex="0" class="prism-code language-deployment.yaml codeBlock_bY9V thin-scrollbar" style="color:#bfc7d5;background-color:#292d3e"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#bfc7d5"><span class="token plain">apiVersion: apps/v1</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">kind: Deployment</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">spec:</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">  containers:</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">    - env:</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">        - name: DD_AGENT_HOST</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">          valueFrom:</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">            fieldRef:</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">              fieldPath: status.hostIP</span><br></span></code></pre></div></div>
<p>Check the official <a href="https://docs.datadoghq.com/agent/kubernetes/apm/?tab=helm" target="_blank" rel="noopener noreferrer" class="">Datadog Tracing Documentation</a> for more detailed information.</p>
<p>To add tracing to Datadog&#x27;s <a href="https://docs.datadoghq.com/synthetics/browser_tests" target="_blank" rel="noopener noreferrer" class="">Browser Test</a> results, add the URLs that the browser tests visits under UX Monitoring/Synthetic Settings/Integration Settings. See <a href="https://docs.datadoghq.com/synthetics/apm" target="_blank" rel="noopener noreferrer" class="">Synthetic APM</a> for more information. You can see a example on how to set this up below. By using a wildcard, multiple endpoints can be traced.</p>
<img alt="Browser Test URLs" src="/img/assets/xks/developer-guide/browser-test-urls.png">
<h3 class="anchor anchorTargetStickyNavbar_Vzrq" id="networkpolicy-datadog">Networkpolicy datadog<a href="#networkpolicy-datadog" class="hash-link" aria-label="Direct link to Networkpolicy datadog" title="Direct link to Networkpolicy datadog" translate="no">​</a></h3>
<p>When using XKF and your cluster has Datadog enabled the tenant namespace will automatically get a networkpolicy that allows egress for tracing and ingress for metrics.</p>
<p>You can view these rules by typing:</p>
<div class="language-shell codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#bfc7d5;--prism-background-color:#292d3e"><div class="codeBlockContent_QJqH"><pre tabindex="0" class="prism-code language-shell codeBlock_bY9V thin-scrollbar" style="color:#bfc7d5;background-color:#292d3e"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#bfc7d5"><span class="token plain">kubectl get networkpolicies -n &lt;tenant-namespace&gt;</span><br></span></code></pre></div></div>
<h2 class="anchor anchorTargetStickyNavbar_Vzrq" id="opentelemetry">Opentelemetry<a href="#opentelemetry" class="hash-link" aria-label="Direct link to Opentelemetry" title="Direct link to Opentelemetry" translate="no">​</a></h2>
<p>To gather opentelemetry data we rely on the <a href="https://github.com/grafana/agent" target="_blank" rel="noopener noreferrer" class="">grafana agent operator</a>.
The grafana agent operator deploys a grafana-agent in a central namespace configured as a part of XKF.</p>
<p>The grafana agent gathers both metrics and logs and is able to receive traces.</p>
<h3 class="anchor anchorTargetStickyNavbar_Vzrq" id="metrics-1">Metrics<a href="#metrics-1" class="hash-link" aria-label="Direct link to Metrics" title="Direct link to Metrics" translate="no">​</a></h3>
<p>To gather metrics data we use servicemonitors or podmonitors that is managed in XKF using the <a href="https://github.com/prometheus-operator/prometheus-operator/" target="_blank" rel="noopener noreferrer" class="">prometheus-operator</a>.</p>
<p>The prometheus-operator has a great <a href="https://github.com/prometheus-operator/prometheus-operator/blob/main/Documentation/user-guides/getting-started.md" target="_blank" rel="noopener noreferrer" class="">getting started guide</a>
but if you want a quick example you can look below.</p>
<p>In order for the grafana agent to find the pod you have to put this exact label on the pod/service monitor yaml: <code>xkf.xenit.io/monitoring: tenant</code>,
or else the grafana agent will not find the rule to gather the metric.</p>
<p>The <a href="https://kubernetes.io/docs/concepts/overview/working-with-objects/labels/" target="_blank" rel="noopener noreferrer" class="">selectors</a> is used to find ether the pod or the service that you want to monitor.</p>
<p>Use a podmonitor when you do not have a service in front of your pod.
For example this might be the case when your application does not use an HTTP endpoint to get requests.</p>
<div class="language-podmonitor.yaml codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#bfc7d5;--prism-background-color:#292d3e"><div class="codeBlockContent_QJqH"><pre tabindex="0" class="prism-code language-podmonitor.yaml codeBlock_bY9V thin-scrollbar" style="color:#bfc7d5;background-color:#292d3e"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#bfc7d5"><span class="token plain">apiVersion: monitoring.coreos.com/v1</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">kind: PodMonitor</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">metadata:</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">  name: podmonitor-example</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">  labels:</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">    xkf.xenit.io/monitoring: tenant</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">spec:</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">  selector:</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">    matchLabels:</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">      app.kubernetes.io/name: app1</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">  podMetricsEndpoints:</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">    - port: http-metrics</span><br></span></code></pre></div></div>
<p>In general use a servicemonitor when you have a service in front of your pod.</p>
<div class="language-servicemonitor.yaml codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#bfc7d5;--prism-background-color:#292d3e"><div class="codeBlockContent_QJqH"><pre tabindex="0" class="prism-code language-servicemonitor.yaml codeBlock_bY9V thin-scrollbar" style="color:#bfc7d5;background-color:#292d3e"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#bfc7d5"><span class="token plain">apiVersion: monitoring.coreos.com/v1</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">kind: ServiceMonitor</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">metadata:</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">  labels:</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">    xkf.xenit.io/monitoring: tenant</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">  name: servicemonitor-example</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">spec:</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">  endpoints:</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">  - interval: 60s</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">    port: metrics</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">  selector:</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">    matchLabels:</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">      app.kubernetes.io/instance: app1</span><br></span></code></pre></div></div>
<p>You can do a lot of configuration when it comes to metrics gathering but the above config will get you started.</p>
<h3 class="anchor anchorTargetStickyNavbar_Vzrq" id="logging-1">Logging<a href="#logging-1" class="hash-link" aria-label="Direct link to Logging" title="Direct link to Logging" translate="no">​</a></h3>
<p>To gather logs from your application you need to define a PodLogs object.</p>
<p>Just like metrics you have to define a label like <code>xkf.xenit.io/monitoring: tenant</code> in your PodLogs.
The PodLogs CRD is created by the grafana agent operator and functions very similarly to how the prometheus operator works, especially when it comes to selectors.
Below you will find a very basic example that will scrape a single pod in the namespace where it is created.</p>
<div class="language-podlogs.yaml codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#bfc7d5;--prism-background-color:#292d3e"><div class="codeBlockContent_QJqH"><pre tabindex="0" class="prism-code language-podlogs.yaml codeBlock_bY9V thin-scrollbar" style="color:#bfc7d5;background-color:#292d3e"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#bfc7d5"><span class="token plain">apiVersion: monitoring.grafana.com/v1alpha1</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">kind: PodLogs</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">metadata:</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">  name: app1</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">  labels:</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">    xkf.xenit.io/monitoring: tenant</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">spec:</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">  selector:</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">    matchLabels:</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">      app.kubernetes.io/name: app1</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">  pipelineStages:</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">    - cri: {}</span><br></span></code></pre></div></div>
<p>You can do a lot of configuration when it comes to log filtering using PodLogs. For example you can drop specific log types that you do not want to send to your long time storage.
Sadly the grafana agent operator does not supply great documentation around how to define this configuration in the operator.
However, together with running <code>kubectl explain podlogs.monitoring.grafana.com.spec.pipelineStages</code> on the cluster and
reading the <a href="https://grafana.com/docs/loki/latest/clients/promtail/pipelines/" target="_blank" rel="noopener noreferrer" class="">official documentation</a> on how to create pipelines you can get a good understanding of how to create the configuration that you need.</p>
<p>If you do not have any needs to filter or do any custom config per application you can create a namespace-wide PodLogs gatherer.</p>
<div class="language-podlogs.yaml codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#bfc7d5;--prism-background-color:#292d3e"><div class="codeBlockContent_QJqH"><pre tabindex="0" class="prism-code language-podlogs.yaml codeBlock_bY9V thin-scrollbar" style="color:#bfc7d5;background-color:#292d3e"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#bfc7d5"><span class="token plain">apiVersion: monitoring.grafana.com/v1alpha1</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">kind: PodLogs</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">metadata:</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">  name: tenant-namespace-log</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">  labels:</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">    xkf.xenit.io/monitoring: tenant</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">spec:</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">  selector: {}</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">  pipelineStages:</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">    - cri: {}</span><br></span></code></pre></div></div>
<h3 class="anchor anchorTargetStickyNavbar_Vzrq" id="tracing-1">Tracing<a href="#tracing-1" class="hash-link" aria-label="Direct link to Tracing" title="Direct link to Tracing" translate="no">​</a></h3>
<p>The tracing setup is a bit different compared to logging and metrics, instead of having some yaml file where you define how to gather metrics and logs from
your application, you instead push data to a central collector.</p>
<p>Opentelemetry supports both HTTP and gRPC communication to gather traces from your application.</p>
<p>To send HTTP data we use <code>4318</code> and for gRPC we use <code>4317</code>.</p>
<p>Point your OpenTelemetry SDK to <a href="http://grafana-agent-traces.opentelemetry.svc.cluster.local:4318/v1/traces" target="_blank" rel="noopener noreferrer" class="">http://grafana-agent-traces.opentelemetry.svc.cluster.local:4318/v1/traces</a>
or <a href="http://grafana-agent-traces.opentelemetry.svc.cluster.local:4317/v1/traces" target="_blank" rel="noopener noreferrer" class="">http://grafana-agent-traces.opentelemetry.svc.cluster.local:4317/v1/traces</a>.</p>
<h4 class="anchor anchorTargetStickyNavbar_Vzrq" id="tail-based-sampling">Tail-based sampling<a href="#tail-based-sampling" class="hash-link" aria-label="Direct link to Tail-based sampling" title="Direct link to Tail-based sampling" translate="no">​</a></h4>
<p>By default the grafana agent that is deployed by XKF forwards all traces without any special config to your service provider.
This can cause high costs thanks to the amount of data that is sent.
You can configure the agent to use <code>probabilistic sampling</code> which grafana agent delivers their own solution for called <a href="https://grafana.com/docs/tempo/latest/grafana-agent/tail-based-sampling/" target="_blank" rel="noopener noreferrer" class="">tail-based sampling</a>, which can help you solve this issue.</p>
<p>To setup a custom agent with tail-based sampling you can setup your own trace agent with the custom config that you want and then have it forward all the traffic to our central trace agent in the <code>opentelemetry</code> namespace.
Below you can find a simple example configmap that you can use together with your trace agent to send data to the central agent.</p>
<div class="language-trace-agent-configmap.yaml codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#bfc7d5;--prism-background-color:#292d3e"><div class="codeBlockContent_QJqH"><pre tabindex="0" class="prism-code language-trace-agent-configmap.yaml codeBlock_bY9V thin-scrollbar" style="color:#bfc7d5;background-color:#292d3e"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#bfc7d5"><span class="token plain">kind: ConfigMap</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">apiVersion: v1</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">metadata:</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">  name: grafana-agent-traces</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">data:</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">  agent.yaml: |</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">    tempo:</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">      configs:</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">        - name: default</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">          remote_write:</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">            - endpoint: &quot;grafana-agent-traces.grafana-agent.svc.cluster.local:4317&quot;</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">              insecure: true</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">          receivers:</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">            otlp:</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">              protocols:</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">                http: {}</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">                grpc: {}</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">          tail_sampling:</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">            # policies define the rules by which traces will be sampled. Multiple policies</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">            # can be added to the same pipeline.</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">            # For more information: https://grafana.com/docs/agent/latest/configuration/traces-config/</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">            # https://github.com/open-telemetry/opentelemetry-collector-contrib/tree/b2327211df976e0a57ef0425493448988772a16b/processor/tailsamplingprocessor</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">            policies:</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">              - probabilistic: {sampling_percentage: 10}</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">              - status_code: {status_codes: [ERROR, UNSET]}</span><br></span></code></pre></div></div>
<h3 class="anchor anchorTargetStickyNavbar_Vzrq" id="networkpolicy-grafana-agent">Networkpolicy grafana agent<a href="#networkpolicy-grafana-agent" class="hash-link" aria-label="Direct link to Networkpolicy grafana agent" title="Direct link to Networkpolicy grafana agent" translate="no">​</a></h3>
<p>When using XKF and your cluster have enabled the grafana agent your tenant namespace will automatically get a networkpolicy that allows
incoming metrics gathering and egress for tracing.</p>
<p>You can view these rules by typing:</p>
<div class="language-shell codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#bfc7d5;--prism-background-color:#292d3e"><div class="codeBlockContent_QJqH"><pre tabindex="0" class="prism-code language-shell codeBlock_bY9V thin-scrollbar" style="color:#bfc7d5;background-color:#292d3e"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#bfc7d5"><span class="token plain">kubectl get networkpolicies -n &lt;tenant-namespace&gt;</span><br></span></code></pre></div></div></div><footer class="theme-doc-footer docusaurus-mt-lg"><div class="row margin-top--sm theme-doc-footer-edit-meta-row"><div class="col noPrint_WFHX"><a href="https://github.com/xenitab/xenitab.github.io/edit/main/docs/xks/developer-guide/observability.md" target="_blank" rel="noopener noreferrer" class="theme-edit-this-page"><svg fill="currentColor" height="20" width="20" viewBox="0 0 40 40" class="iconEdit_Z9Sw" aria-hidden="true"><g><path d="m34.5 11.7l-3 3.1-6.3-6.3 3.1-3q0.5-0.5 1.2-0.5t1.1 0.5l3.9 3.9q0.5 0.4 0.5 1.1t-0.5 1.2z m-29.5 17.1l18.4-18.5 6.3 6.3-18.4 18.4h-6.3v-6.2z"></path></g></svg>Edit this page</a></div><div class="col lastUpdated_JAkA"></div></div></footer></article><nav class="docusaurus-mt-lg pagination-nav" aria-label="Docs pages"><a class="pagination-nav__link pagination-nav__link--prev" href="/docs/xks/developer-guide/scheduling-scaling"><div class="pagination-nav__sublabel">Previous</div><div class="pagination-nav__label">Scheduling and Scaling</div></a><a class="pagination-nav__link pagination-nav__link--next" href="/docs/xks/developer-guide/networking"><div class="pagination-nav__sublabel">Next</div><div class="pagination-nav__label">Networking</div></a></nav></div></div><div class="col col--3"><div class="tableOfContents_bqdL thin-scrollbar theme-doc-toc-desktop"><ul class="table-of-contents table-of-contents__left-border"><li><a href="#what-is-observability" class="table-of-contents__link toc-highlight">What is observability?</a></li><li><a href="#datadog" class="table-of-contents__link toc-highlight">Datadog</a><ul><li><a href="#logging" class="table-of-contents__link toc-highlight">Logging</a></li><li><a href="#metrics" class="table-of-contents__link toc-highlight">Metrics</a></li><li><a href="#tracing" class="table-of-contents__link toc-highlight">Tracing</a></li><li><a href="#networkpolicy-datadog" class="table-of-contents__link toc-highlight">Networkpolicy datadog</a></li></ul></li><li><a href="#opentelemetry" class="table-of-contents__link toc-highlight">Opentelemetry</a><ul><li><a href="#metrics-1" class="table-of-contents__link toc-highlight">Metrics</a></li><li><a href="#logging-1" class="table-of-contents__link toc-highlight">Logging</a></li><li><a href="#tracing-1" class="table-of-contents__link toc-highlight">Tracing</a></li><li><a href="#networkpolicy-grafana-agent" class="table-of-contents__link toc-highlight">Networkpolicy grafana agent</a></li></ul></li></ul></div></div></div></div></main></div></div></div></div>
</body>
</html>