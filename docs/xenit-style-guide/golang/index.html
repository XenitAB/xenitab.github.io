<!doctype html>
<html class="docs-version-current" lang="en" dir="ltr">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width,initial-scale=1">
<meta name="generator" content="Docusaurus v2.0.0-beta.15">
<link rel="alternate" type="application/rss+xml" href="/blog/rss.xml" title="Xenit RSS Feed">
<link rel="alternate" type="application/atom+xml" href="/blog/atom.xml" title="Xenit Atom Feed">
<link rel="preconnect" href="https://www.google-analytics.com">
<link rel="preconnect" href="https://www.googletagmanager.com">
<script async src="https://www.googletagmanager.com/gtag/js?id=GTM-5K3TQ3K"></script>
<script>function gtag(){dataLayer.push(arguments)}window.dataLayer=window.dataLayer||[],gtag("js",new Date),gtag("config","GTM-5K3TQ3K",{anonymize_ip:!0})</script><title data-react-helmet="true">Golang | Xenit</title><meta data-react-helmet="true" name="twitter:card" content="summary_large_image"><meta data-react-helmet="true" property="og:image" content="http://xenitab.github.io/img/Xenit_logo_Svart.png"><meta data-react-helmet="true" name="twitter:image" content="http://xenitab.github.io/img/Xenit_logo_Svart.png"><meta data-react-helmet="true" property="og:url" content="http://xenitab.github.io/docs/xenit-style-guide/golang"><meta data-react-helmet="true" name="docusaurus_locale" content="en"><meta data-react-helmet="true" name="docusaurus_version" content="current"><meta data-react-helmet="true" name="docusaurus_tag" content="docs-default-current"><meta data-react-helmet="true" property="og:title" content="Golang | Xenit"><meta data-react-helmet="true" name="description" content="Golang (Go) is one of the most common languages at Xenit especially for backend systems and open source projects. It should be the first language choice when starting a new project."><meta data-react-helmet="true" property="og:description" content="Golang (Go) is one of the most common languages at Xenit especially for backend systems and open source projects. It should be the first language choice when starting a new project."><link data-react-helmet="true" rel="icon" href="/img/favicon.ico"><link data-react-helmet="true" rel="canonical" href="http://xenitab.github.io/docs/xenit-style-guide/golang"><link data-react-helmet="true" rel="alternate" href="http://xenitab.github.io/docs/xenit-style-guide/golang" hreflang="en"><link data-react-helmet="true" rel="alternate" href="http://xenitab.github.io/docs/xenit-style-guide/golang" hreflang="x-default"><link rel="stylesheet" href="/assets/css/styles.018923a1.css">
<link rel="preload" href="/assets/js/runtime~main.ac0486a3.js" as="script">
<link rel="preload" href="/assets/js/main.d2947b01.js" as="script">
</head>
<body>
<script>!function(){function t(t){document.documentElement.setAttribute("data-theme",t)}var e=function(){var t=null;try{t=localStorage.getItem("theme")}catch(t){}return t}();t(null!==e?e:"light")}()</script><div id="__docusaurus">
<div role="region"><a href="#" class="skipToContent_ZgBM">Skip to main content</a></div><nav class="navbar navbar--fixed-top"><div class="navbar__inner"><div class="navbar__items"><button aria-label="Navigation bar toggle" class="navbar__toggle clean-btn" type="button" tabindex="0"><svg width="30" height="30" viewBox="0 0 30 30" aria-hidden="true"><path stroke="currentColor" stroke-linecap="round" stroke-miterlimit="10" stroke-width="2" d="M4 7h22M4 15h22M4 23h22"></path></svg></button><a class="navbar__brand" href="/"><div class="navbar__logo"><img src="/img/Xenit_logo_Svart.png" alt="Xenit logo" class="themedImage_W2Cr themedImage--light_TfLj"><img src="/img/Xenit_logo_Vit.png" alt="Xenit logo" class="themedImage_W2Cr themedImage--dark_oUvU"></div></a></div><div class="navbar__items navbar__items--right"><a aria-current="page" class="navbar__item navbar__link navbar__link--active" href="/docs/">Docs</a><a class="navbar__item navbar__link" href="/blog/">Blog</a><a href="https://github.com/XenitAB" target="_blank" rel="noopener noreferrer" class="navbar__item navbar__link"><span>GitHub<svg width="13.5" height="13.5" aria-hidden="true" viewBox="0 0 24 24" class="iconExternalLink_I5OW"><path fill="currentColor" d="M21 13v10h-21v-19h12v2h-10v15h17v-8h2zm3-12h-10.988l4.035 4-6.977 7.07 2.828 2.828 6.977-7.07 4.125 4.172v-11z"></path></svg></span></a><div class="toggle_Pssr toggle_TdHA toggleDisabled_jDku"><div class="toggleTrack_SSoT" role="button" tabindex="-1"><div class="toggleTrackCheck_XobZ"><span class="toggleIcon_eZtF">ðŸŒœ</span></div><div class="toggleTrackX_YkSC"><span class="toggleIcon_eZtF">ðŸŒž</span></div><div class="toggleTrackThumb_uRm4"></div></div><input type="checkbox" class="toggleScreenReader_JnkT" aria-label="Switch between dark and light mode"></div><div class="navbar__search"><span aria-label="expand searchbar" role="button" class="search-icon" tabindex="0"></span><input type="search" id="search_input_react" placeholder="Loading..." aria-label="Search" class="navbar__search-input search-bar" disabled=""></div></div></div><div role="presentation" class="navbar-sidebar__backdrop"></div></nav><div class="main-wrapper docs-wrapper docs-doc-page"><div class="docPage_P2Lg"><button aria-label="Scroll back to top" class="clean-btn theme-back-to-top-button backToTopButton_RiI4" type="button"></button><aside class="theme-doc-sidebar-container docSidebarContainer_rKC_"><div class="sidebar_CW9Y"><nav class="menu thin-scrollbar menu_SkdO"><ul class="theme-doc-sidebar-menu menu__list"><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-1 menu__list-item"><a class="menu__link" href="/docs/">Introduction</a></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-1 menu__list-item menu__list-item--collapsed"><div class="menu__list-item-collapsible"><a class="menu__link menu__link--sublist hasHref_VCh3" href="/docs/xks/">Xenit Kubernetes Service</a></div></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-1 menu__list-item"><div class="menu__list-item-collapsible"><a class="menu__link menu__link--sublist menu__link--active hasHref_VCh3" aria-current="page" href="/docs/xenit-style-guide/containers">Xenit Style Guide</a></div><ul style="display:block;overflow:visible;height:auto" class="menu__list"><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class="menu__link" tabindex="0" href="/docs/xenit-style-guide/containers">Containers</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class="menu__link menu__link--active" aria-current="page" tabindex="0" href="/docs/xenit-style-guide/golang">Golang</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class="menu__link" tabindex="0" href="/docs/xenit-style-guide/javascript">Javascript</a></li></ul></li></ul></nav></div></aside><main class="docMainContainer_TCnq"><div class="container padding-top--md padding-bottom--lg"><div class="row"><div class="col docItemCol_DM6M"><div class="docItemContainer_vinB"><article><div class="tocCollapsible_jdIR theme-doc-toc-mobile tocMobile_TmEX"><button type="button" class="clean-btn tocCollapsibleButton_Fzxq">On this page</button></div><div class="theme-doc-markdown markdown"><header><h1>Golang</h1></header><p>Golang (Go) is one of the most common languages at Xenit especially for backend systems and open source projects. It should be the first language choice when starting a new project.</p><h2 class="anchor anchorWithStickyNavbar_mojV" id="shared-library">Shared Library<a class="hash-link" href="#shared-library" title="Direct link to heading">â€‹</a></h2><p>Some code may be best to share between multiple repositories. These shared packages should be stored in <a href="https://github.com/xenitAB/pkg" target="_blank" rel="noopener noreferrer">pkg</a>.</p><h2 class="anchor anchorWithStickyNavbar_mojV" id="startup-and-shutdown">Startup and Shutdown<a class="hash-link" href="#startup-and-shutdown" title="Direct link to heading">â€‹</a></h2><p>It may seem a bit nit picky to document how a program should startup and shutdown, but it is necissary as there are a lot of resources like blogs which offer a multitude of solutions how it could be implemented. Doing this properly is important to make sure that all incoming messages such as HTTP requests and processed before shutting down, the alternative would be to cancel HTTP request without responding to them. There are generally two event soures which cause a shutdown, either an internal error which requires the program shutdown or an <a href="https://pkg.go.dev/os/signal" target="_blank" rel="noopener noreferrer">external signal</a> notifying the program to shut down.</p><p>In a lot of cases a program may run multiple go routines simultaneously, and example of this would be running both the buisness logic HTTP server and the HTTP server that is serving metrics. All of these would need to be gracefully stopped and also cause a graceful shutdown in case of an error. The <a href="https://pkg.go.dev/golang.org/x/sync/errgroup" target="_blank" rel="noopener noreferrer">errgroup</a> package offers a solution to this problem by wrapping the go routines with an error handler which cancels a context when one of the go routines returns an error.</p><div class="codeBlockContainer_I0IT language-golang theme-code-block"><div class="codeBlockContent_wNvx golang"><pre tabindex="0" class="prism-code language-golang codeBlock_jd64 thin-scrollbar" style="color:#bfc7d5;background-color:#292d3e"><code class="codeBlockLines_mRuA"><span class="token-line" style="color:#bfc7d5"><span class="token plain">package main</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">import (</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">    &quot;context&quot;</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">    &quot;fmt&quot;</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">    &quot;os&quot;</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">    &quot;os/signal&quot;</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">    &quot;time&quot;</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">    &quot;golang.org/x/sync/errgroup&quot;</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">)</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">func main() {</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">    ctx, cancel := signal.NotifyContext(context.Background(), os.Interrupt)</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">    defer cancel()</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">    g, ctx := errgroup.WithContext(ctx)</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">    g.Go(func() error {</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">        &lt;-ctx.Done()</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">        fmt.Println(&quot;completed 1&quot;)</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">        return nil</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">    })</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">    g.Go(func() error {</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">        var err error</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">        select {</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">        case &lt;-ctx.Done():</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">        case &lt;-time.After(5 * time.Second):</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">            err = fmt.Errorf(&quot;example timeout error&quot;)</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">        }</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">        fmt.Println(&quot;completed 2&quot;)</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">        return err</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">    })</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">    g.Go(func() error {</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">        &lt;-ctx.Done()</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">        fmt.Println(&quot;completed 3&quot;)</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">        return nil</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">    })</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">    fmt.Println(&quot;running&quot;)</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">    if err := g.Wait(); err != nil {</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">        fmt.Printf(&quot;stopped with error: %v\n&quot;, err)</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">        os.Exit(1)</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">        return</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">    }</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">    fmt.Println(&quot;stopped without error&quot;)</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">}</span><br></span></code></pre><button type="button" aria-label="Copy code to clipboard" class="copyButton_wuS7 clean-btn">Copy</button></div></div><p>All of the go routines will run at the same time. The program can be stopped with two methods. Either it runs for 5 seconds and the second go routine will return an error, or a signal will stop the program before the error is returned. Either way the context will be cancelled causing all of the go routines to run to completion. When this occurs the <code>Wait()</code> call returns wither with the error returned from one of the go routines or nil. This logic may seem complicated but is with the help of error groups simple to implement.</p><p>A general good practice when building programs with multiple go routines is to allow the error group to manage the go routine. This means that all functions when possible should be blocking and should not implement there own threading and error handling. Instead if possible the functions should accept a context as a parameter and listen to the returned done channel. This increases testability of individual components while simplifying logic and decreasing risks of improper shutdowns and orphande go routines.</p><h2 class="anchor anchorWithStickyNavbar_mojV" id="program-input">Program Input<a class="hash-link" href="#program-input" title="Direct link to heading">â€‹</a></h2><p>Go has a lot of options when parsing program input flags and commands. On top of the standard <code>flag</code> library there are a bunch of other options out there that do the one or the other, or both. For this reason it is good to standardize on a library to use at Xenit. The most popular libraries at this time are <a href="https://github.com/spf13/cobra" target="_blank" rel="noopener noreferrer">cobra</a> and by extension <a href="https://github.com/spf13/pflag" target="_blank" rel="noopener noreferrer">pflag</a>. While these libraries may be popular they also introduce a lot of opinion and complexity to the project structure.</p><p>A lightweight alternative is <a href="https://github.com/alexflint/go-arg" target="_blank" rel="noopener noreferrer">go-arg</a> which offers the same feature set in a less opinionated manner. It offers most features that can be needed such as struct mapping, environment variables, default values, descriptions, short and long form, and argument lists. On top of these features it offers support for subcommands which allows for specific arguments which are only expected for specific subcommands.</p><p>All flags are defined in a struct which is then populated with the input args. All configuration of the parsing is done through annotations.</p><div class="codeBlockContainer_I0IT language-golang theme-code-block"><div class="codeBlockContent_wNvx golang"><pre tabindex="0" class="prism-code language-golang codeBlock_jd64 thin-scrollbar" style="color:#bfc7d5;background-color:#292d3e"><code class="codeBlockLines_mRuA"><span class="token-line" style="color:#bfc7d5"><span class="token plain">package main</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">import (</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">    &quot;fmt&quot;</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">    &quot;github.com/alexflint/go-arg&quot;</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">)</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">type args struct {</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">    Id      bool `arg:&quot;-i,--id,env:ID&quot; help:&quot;id input&quot;`</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">    Verbose bool `arg:&quot;-v,--verbose,env:VERBOSE&quot; default:&quot;true&quot; help:&quot;verbosity level&quot;`</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">}</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">func main() {</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">    a := &amp;args{}</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">    arg.MustParse(a)</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">    fmt.Printf(&quot;%#v\n&quot;, a)</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">}</span><br></span></code></pre><button type="button" aria-label="Copy code to clipboard" class="copyButton_wuS7 clean-btn">Copy</button></div></div><p>Subcommands are useful when there are multiple functions that can be called in the same program.</p><div class="codeBlockContainer_I0IT language-golang theme-code-block"><div class="codeBlockContent_wNvx golang"><pre tabindex="0" class="prism-code language-golang codeBlock_jd64 thin-scrollbar" style="color:#bfc7d5;background-color:#292d3e"><code class="codeBlockLines_mRuA"><span class="token-line" style="color:#bfc7d5"><span class="token plain">type CheckoutCmd struct {</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">    Branch string `arg:&quot;positional&quot;`</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">    Track  bool   `arg:&quot;-t&quot;`</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">}</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">type CommitCmd struct {</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">    All     bool   `arg:&quot;-a&quot;`</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">    Message string `arg:&quot;-m&quot;`</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">}</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">type PushCmd struct {</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">    Remote      string `arg:&quot;positional&quot;`</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">    Branch      string `arg:&quot;positional&quot;`</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">    SetUpstream bool   `arg:&quot;-u&quot;`</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">}</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">var args struct {</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">    Checkout *CheckoutCmd `arg:&quot;subcommand:checkout&quot;`</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">    Commit   *CommitCmd   `arg:&quot;subcommand:commit&quot;`</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">    Push     *PushCmd     `arg:&quot;subcommand:push&quot;`</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">    Quiet    bool         `arg:&quot;-q&quot;` // this flag is global to all subcommands</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">}</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">arg.MustParse(&amp;args)</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">switch {</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">case args.Checkout != nil:</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">    fmt.Printf(&quot;checkout requested for branch %s\n&quot;, args.Checkout.Branch)</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">case args.Commit != nil:</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">    fmt.Printf(&quot;commit requested with message \&quot;%s\&quot;\n&quot;, args.Commit.Message)</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">case args.Push != nil:</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">    fmt.Printf(&quot;push requested from %s to %s\n&quot;, args.Push.Branch, args.Push.Remote)</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">}</span><br></span></code></pre><button type="button" aria-label="Copy code to clipboard" class="copyButton_wuS7 clean-btn">Copy</button></div></div><p>Refer to the <a href="https://pkg.go.dev/github.com/alexflint/go-arg" target="_blank" rel="noopener noreferrer">API Documentation</a> for more detailed information.</p><h2 class="anchor anchorWithStickyNavbar_mojV" id="logging">Logging<a class="hash-link" href="#logging" title="Direct link to heading">â€‹</a></h2><p>The options when logging with Go is usual many and opinionated, they depend on the required output format or how variables are passed. Currently the best compromise out there is <a href="https://github.com/go-logr/logr" target="_blank" rel="noopener noreferrer">logr</a> which is a logging interface compatible with a lot of logging libraries. This means that the logging library can easily be replaced in the future without having to refactor the whole code base. A main feature of logr is that it supports structured logging, which means that parameters can easily be passed with the log message in a structured manner.  </p><div class="admonition admonition-caution alert alert--warning"><div class="admonition-heading"><h5><span class="admonition-icon"><svg xmlns="http://www.w3.org/2000/svg" width="16" height="16" viewBox="0 0 16 16"><path fill-rule="evenodd" d="M8.893 1.5c-.183-.31-.52-.5-.887-.5s-.703.19-.886.5L.138 13.499a.98.98 0 0 0 0 1.001c.193.31.53.501.886.501h13.964c.367 0 .704-.19.877-.5a1.03 1.03 0 0 0 .01-1.002L8.893 1.5zm.133 11.497H6.987v-2.003h2.039v2.003zm0-3.004H6.987V5.987h2.039v4.006z"></path></svg></span>caution</h5></div><div class="admonition-content"><p>Using the <code>status</code> field when logging can interfere with how Datadog interprets the severity of the log. If you have a log with fields <code>status = 400</code> and <code>level = error</code>, then Datadog reports this as an info log. If you use another field for the status code, for example <code>http_response.status_code</code>, together with <code>level = error</code>, Datadog will report it as an error log. You can read more about the <code>status</code> field and other reserved log fields in Datadog <a href="https://docs.datadoghq.com/logs/log_configuration/attributes_naming_convention/#reserved-attributes" target="_blank" rel="noopener noreferrer">here</a>.</p></div></div><p>Unless there are any other requirements it is good to use the <a href="https://github.com/go-logr/zapr" target="_blank" rel="noopener noreferrer">zapr</a> logger. Zapr is fast and will output logs as JSON.</p><div class="codeBlockContainer_I0IT language-golang theme-code-block"><div class="codeBlockContent_wNvx golang"><pre tabindex="0" class="prism-code language-golang codeBlock_jd64 thin-scrollbar" style="color:#bfc7d5;background-color:#292d3e"><code class="codeBlockLines_mRuA"><span class="token-line" style="color:#bfc7d5"><span class="token plain">package main</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">import (</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">    &quot;context&quot;</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">    &quot;fmt&quot;</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">    &quot;github.com/go-logr/logr&quot;</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">    &quot;github.com/go-logr/zapr&quot;</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">    &quot;go.uber.org/zap&quot;</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">)</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">func main() {</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">    zapLog, err := zap.NewProduction()</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">    if err != nil {</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">        panic(fmt.Sprintf(&quot;who watches the watchmen (%v)?&quot;, err))</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">    }</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">    log := zapr.NewLogger(zapLog)</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">    log.Info(&quot;Logr in action!&quot;, &quot;the answer&quot;, 42)</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">}</span><br></span></code></pre><button type="button" aria-label="Copy code to clipboard" class="copyButton_wuS7 clean-btn">Copy</button></div></div><p>The logging object should be passed through the context when calling a function that needs to log. This removes the need to add an additional parameter that needs to be tracked.</p><div class="codeBlockContainer_I0IT language-golang theme-code-block"><div class="codeBlockContent_wNvx golang"><pre tabindex="0" class="prism-code language-golang codeBlock_jd64 thin-scrollbar" style="color:#bfc7d5;background-color:#292d3e"><code class="codeBlockLines_mRuA"><span class="token-line" style="color:#bfc7d5"><span class="token plain">ctx := logr.NewContext(context.Background(), log)</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">run(ctx)</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">func run(ctx context.Context) {</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">    log := logr.FromContextOrDiscard(ctx)</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">    log.Info(&quot;running function&quot;)</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">}</span><br></span></code></pre><button type="button" aria-label="Copy code to clipboard" class="copyButton_wuS7 clean-btn">Copy</button></div></div><h2 class="anchor anchorWithStickyNavbar_mojV" id="http">HTTP<a class="hash-link" href="#http" title="Direct link to heading">â€‹</a></h2><p>The Go standard library includes a http package that works well for simple applications, but requires a lot of custom code when building larger projects. While it is fine to just use the standard library for simple applications it is preferable to switch to <a href="https://github.com/gin-gonic/gin" target="_blank" rel="noopener noreferrer">Gin</a> as project feature requirements develop. Gin provides extra functionality and extensions to simplify things like parsing parameters in the URL path and endpoint authorization.</p><p>The HTTP server should be started and stopped in accordance to the Startup and Shutdown documentation. The HTTP server should be gracefully stopped before the program exits to make sure that all in flight requests are processed. A good practice is to use the <a href="https://github.com/XenitAB/pkg/tree/main/middleware/logger" target="_blank" rel="noopener noreferrer">logger middleware</a> to log all incoming requests to the HTTP server.</p><div class="codeBlockContainer_I0IT language-golang theme-code-block"><div class="codeBlockContent_wNvx golang"><pre tabindex="0" class="prism-code language-golang codeBlock_jd64 thin-scrollbar" style="color:#bfc7d5;background-color:#292d3e"><code class="codeBlockLines_mRuA"><span class="token-line" style="color:#bfc7d5"><span class="token plain">package main</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">import (</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">    &quot;context&quot;</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">    &quot;errors&quot;</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">    &quot;fmt&quot;</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">    &quot;net/http&quot;</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">    &quot;os&quot;</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">    &quot;os/signal&quot;</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">    &quot;time&quot;</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">    &quot;golang.org/x/sync/errgroup&quot;</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">    &quot;github.com/alexflint/go-arg&quot;</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">    &quot;github.com/gin-gonic/gin&quot;</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">    &quot;github.com/go-logr/zapr&quot;</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">    &quot;github.com/xenitab/pkg/middleware/logger&quot;</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">    &quot;go.uber.org/zap&quot;</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">)</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">type arguments struct {</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">    Addr string `arg:&quot;--addr&quot; default:&quot;:8080&quot;`</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">}</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">func main() {</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">    zapLog, err := zap.NewProduction()</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">    if err != nil {</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">        panic(fmt.Sprintf(&quot;who watches the watchmen (%v)?&quot;, err))</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">    }</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">    log := zapr.NewLogger(zapLog)</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">    args := &amp;arguments{}</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">    arg.MustParse(args)</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">    ctx, cancel := signal.NotifyContext(context.Background(), os.Interrupt)</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">    defer cancel()</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">    g, ctx := errgroup.WithContext(ctx)</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">    gin.SetMode(gin.ReleaseMode)</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">    router := gin.New()</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">    router.Use(logger.Logger(log))</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">    router.Use(gin.Recovery())</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">    router.GET(&quot;/ping&quot;, func(c *gin.Context) {</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">        c.JSON(http.StatusOK, gin.H{</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">            &quot;message&quot;: &quot;pong&quot;,</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">        })</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">    })</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">    srv := &amp;http.Server{</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">        Addr:    args.Addr,</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">        Handler: router,</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">    }</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">    g.Go(func() error {</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">        if err := srv.ListenAndServe(); err != nil &amp;&amp; !errors.Is(err, http.ErrServerClosed) {</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">            return err</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">        }</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">        return nil</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">    })</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">    g.Go(func() error {</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">        &lt;-ctx.Done()</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">        shutdownCtx, cancel := context.WithTimeout(context.Background(), 5*time.Second)</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">        defer cancel()</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">        return srv.Shutdown(shutdownCtx)</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">    })</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">    fmt.Println(&quot;running&quot;)</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">    if err := g.Wait(); err != nil {</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">        fmt.Printf(&quot;stopped with error: %v\n&quot;, err)</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">        os.Exit(1)</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">        return</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">    }</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">    fmt.Println(&quot;stopped without error&quot;)</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">}</span><br></span></code></pre><button type="button" aria-label="Copy code to clipboard" class="copyButton_wuS7 clean-btn">Copy</button></div></div><h2 class="anchor anchorWithStickyNavbar_mojV" id="metrics">Metrics<a class="hash-link" href="#metrics" title="Direct link to heading">â€‹</a></h2><p>The <a href="https://github.com/penglongli/gin-metrics" target="_blank" rel="noopener noreferrer">ginmetrics</a> library can be used to export metrics for Prometheus when using the gin HTTP server. The example below sets up a two gin servers, one user-facing on port <code>8080</code> and one exposing metrics on port <code>8081</code>. Now, after visiting <code>http://localhost:8080/increment-counter</code>, the value of <code>my_counter</code> can be seen on <code>http://localhost:8081/metrics</code> together with some default metrics.</p><div class="codeBlockContainer_I0IT language-go theme-code-block"><div class="codeBlockContent_wNvx go"><pre tabindex="0" class="prism-code language-go codeBlock_jd64 thin-scrollbar" style="color:#bfc7d5;background-color:#292d3e"><code class="codeBlockLines_mRuA"><span class="token-line" style="color:#bfc7d5"><span class="token keyword" style="font-style:italic">import</span><span class="token plain"> </span><span class="token punctuation" style="color:rgb(199, 146, 234)">(</span><span class="token plain"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">    </span><span class="token string" style="color:rgb(195, 232, 141)">&quot;github.com/gin-gonic/gin&quot;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">    </span><span class="token string" style="color:rgb(195, 232, 141)">&quot;github.com/penglongli/gin-metrics/ginmetrics&quot;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain"></span><span class="token punctuation" style="color:rgb(199, 146, 234)">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain"></span><span class="token keyword" style="font-style:italic">func</span><span class="token plain"> </span><span class="token function" style="color:rgb(130, 170, 255)">main</span><span class="token punctuation" style="color:rgb(199, 146, 234)">(</span><span class="token punctuation" style="color:rgb(199, 146, 234)">)</span><span class="token plain"> </span><span class="token punctuation" style="color:rgb(199, 146, 234)">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">    apiRouter </span><span class="token operator" style="color:rgb(137, 221, 255)">:=</span><span class="token plain"> gin</span><span class="token punctuation" style="color:rgb(199, 146, 234)">.</span><span class="token function" style="color:rgb(130, 170, 255)">Default</span><span class="token punctuation" style="color:rgb(199, 146, 234)">(</span><span class="token punctuation" style="color:rgb(199, 146, 234)">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">    </span><span class="token comment" style="color:rgb(105, 112, 152);font-style:italic">// Add a route that increments the counter `my_counter`</span><span class="token plain"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">    apiRouter</span><span class="token punctuation" style="color:rgb(199, 146, 234)">.</span><span class="token function" style="color:rgb(130, 170, 255)">GET</span><span class="token punctuation" style="color:rgb(199, 146, 234)">(</span><span class="token string" style="color:rgb(195, 232, 141)">&quot;/increment-counter&quot;</span><span class="token punctuation" style="color:rgb(199, 146, 234)">,</span><span class="token plain"> </span><span class="token keyword" style="font-style:italic">func</span><span class="token punctuation" style="color:rgb(199, 146, 234)">(</span><span class="token plain">c </span><span class="token operator" style="color:rgb(137, 221, 255)">*</span><span class="token plain">gin</span><span class="token punctuation" style="color:rgb(199, 146, 234)">.</span><span class="token plain">Context</span><span class="token punctuation" style="color:rgb(199, 146, 234)">)</span><span class="token plain"> </span><span class="token punctuation" style="color:rgb(199, 146, 234)">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">        </span><span class="token boolean" style="color:rgb(255, 88, 116)">_</span><span class="token plain"> </span><span class="token operator" style="color:rgb(137, 221, 255)">=</span><span class="token plain"> ginmetrics</span><span class="token punctuation" style="color:rgb(199, 146, 234)">.</span><span class="token function" style="color:rgb(130, 170, 255)">GetMonitor</span><span class="token punctuation" style="color:rgb(199, 146, 234)">(</span><span class="token punctuation" style="color:rgb(199, 146, 234)">)</span><span class="token punctuation" style="color:rgb(199, 146, 234)">.</span><span class="token function" style="color:rgb(130, 170, 255)">GetMetric</span><span class="token punctuation" style="color:rgb(199, 146, 234)">(</span><span class="token string" style="color:rgb(195, 232, 141)">&quot;my_counter&quot;</span><span class="token punctuation" style="color:rgb(199, 146, 234)">)</span><span class="token punctuation" style="color:rgb(199, 146, 234)">.</span><span class="token function" style="color:rgb(130, 170, 255)">Inc</span><span class="token punctuation" style="color:rgb(199, 146, 234)">(</span><span class="token punctuation" style="color:rgb(199, 146, 234)">[</span><span class="token punctuation" style="color:rgb(199, 146, 234)">]</span><span class="token builtin" style="color:rgb(130, 170, 255)">string</span><span class="token punctuation" style="color:rgb(199, 146, 234)">{</span><span class="token string" style="color:rgb(195, 232, 141)">&quot;label1-value&quot;</span><span class="token punctuation" style="color:rgb(199, 146, 234)">}</span><span class="token punctuation" style="color:rgb(199, 146, 234)">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">        c</span><span class="token punctuation" style="color:rgb(199, 146, 234)">.</span><span class="token function" style="color:rgb(130, 170, 255)">JSON</span><span class="token punctuation" style="color:rgb(199, 146, 234)">(</span><span class="token number" style="color:rgb(247, 140, 108)">200</span><span class="token punctuation" style="color:rgb(199, 146, 234)">,</span><span class="token plain"> gin</span><span class="token punctuation" style="color:rgb(199, 146, 234)">.</span><span class="token plain">H</span><span class="token punctuation" style="color:rgb(199, 146, 234)">{</span><span class="token string" style="color:rgb(195, 232, 141)">&quot;message&quot;</span><span class="token punctuation" style="color:rgb(199, 146, 234)">:</span><span class="token plain"> </span><span class="token string" style="color:rgb(195, 232, 141)">&quot;Incremented counter `my_counter`&quot;</span><span class="token punctuation" style="color:rgb(199, 146, 234)">}</span><span class="token punctuation" style="color:rgb(199, 146, 234)">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">    </span><span class="token punctuation" style="color:rgb(199, 146, 234)">}</span><span class="token punctuation" style="color:rgb(199, 146, 234)">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">    </span><span class="token comment" style="color:rgb(105, 112, 152);font-style:italic">// Get the global metrics monitor</span><span class="token plain"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">    monitor </span><span class="token operator" style="color:rgb(137, 221, 255)">:=</span><span class="token plain"> ginmetrics</span><span class="token punctuation" style="color:rgb(199, 146, 234)">.</span><span class="token function" style="color:rgb(130, 170, 255)">GetMonitor</span><span class="token punctuation" style="color:rgb(199, 146, 234)">(</span><span class="token punctuation" style="color:rgb(199, 146, 234)">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">    </span><span class="token comment" style="color:rgb(105, 112, 152);font-style:italic">// Set the metrics path, the default is /debug/metrics</span><span class="token plain"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">    monitor</span><span class="token punctuation" style="color:rgb(199, 146, 234)">.</span><span class="token function" style="color:rgb(130, 170, 255)">SetMetricPath</span><span class="token punctuation" style="color:rgb(199, 146, 234)">(</span><span class="token string" style="color:rgb(195, 232, 141)">&quot;/metrics&quot;</span><span class="token punctuation" style="color:rgb(199, 146, 234)">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">    </span><span class="token comment" style="color:rgb(105, 112, 152);font-style:italic">// Let the api router use the metrics server without exposing the metrics</span><span class="token plain"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">    </span><span class="token comment" style="color:rgb(105, 112, 152);font-style:italic">// path on the same port. This is useful to not expose the metrics to the</span><span class="token plain"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">    </span><span class="token comment" style="color:rgb(105, 112, 152);font-style:italic">// user.</span><span class="token plain"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">    monitor</span><span class="token punctuation" style="color:rgb(199, 146, 234)">.</span><span class="token function" style="color:rgb(130, 170, 255)">UseWithoutExposingEndpoint</span><span class="token punctuation" style="color:rgb(199, 146, 234)">(</span><span class="token plain">apiRouter</span><span class="token punctuation" style="color:rgb(199, 146, 234)">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">    </span><span class="token comment" style="color:rgb(105, 112, 152);font-style:italic">// Create and add a counter</span><span class="token plain"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">    counter </span><span class="token operator" style="color:rgb(137, 221, 255)">:=</span><span class="token plain"> </span><span class="token operator" style="color:rgb(137, 221, 255)">&amp;</span><span class="token plain">ginmetrics</span><span class="token punctuation" style="color:rgb(199, 146, 234)">.</span><span class="token plain">Metric</span><span class="token punctuation" style="color:rgb(199, 146, 234)">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">        Type</span><span class="token punctuation" style="color:rgb(199, 146, 234)">:</span><span class="token plain">        ginmetrics</span><span class="token punctuation" style="color:rgb(199, 146, 234)">.</span><span class="token plain">Counter</span><span class="token punctuation" style="color:rgb(199, 146, 234)">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">        Name</span><span class="token punctuation" style="color:rgb(199, 146, 234)">:</span><span class="token plain">        </span><span class="token string" style="color:rgb(195, 232, 141)">&quot;my_counter&quot;</span><span class="token punctuation" style="color:rgb(199, 146, 234)">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">        Description</span><span class="token punctuation" style="color:rgb(199, 146, 234)">:</span><span class="token plain"> </span><span class="token string" style="color:rgb(195, 232, 141)">&quot;description of counter&quot;</span><span class="token punctuation" style="color:rgb(199, 146, 234)">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">        Labels</span><span class="token punctuation" style="color:rgb(199, 146, 234)">:</span><span class="token plain">      </span><span class="token punctuation" style="color:rgb(199, 146, 234)">[</span><span class="token punctuation" style="color:rgb(199, 146, 234)">]</span><span class="token builtin" style="color:rgb(130, 170, 255)">string</span><span class="token punctuation" style="color:rgb(199, 146, 234)">{</span><span class="token string" style="color:rgb(195, 232, 141)">&quot;label1&quot;</span><span class="token punctuation" style="color:rgb(199, 146, 234)">}</span><span class="token punctuation" style="color:rgb(199, 146, 234)">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">    </span><span class="token punctuation" style="color:rgb(199, 146, 234)">}</span><span class="token plain"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">    monitor</span><span class="token punctuation" style="color:rgb(199, 146, 234)">.</span><span class="token function" style="color:rgb(130, 170, 255)">AddMetric</span><span class="token punctuation" style="color:rgb(199, 146, 234)">(</span><span class="token plain">counter</span><span class="token punctuation" style="color:rgb(199, 146, 234)">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">    </span><span class="token comment" style="color:rgb(105, 112, 152);font-style:italic">// Create a metrics router and add the metric path to it</span><span class="token plain"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">    metricsRouter </span><span class="token operator" style="color:rgb(137, 221, 255)">:=</span><span class="token plain"> gin</span><span class="token punctuation" style="color:rgb(199, 146, 234)">.</span><span class="token function" style="color:rgb(130, 170, 255)">New</span><span class="token punctuation" style="color:rgb(199, 146, 234)">(</span><span class="token punctuation" style="color:rgb(199, 146, 234)">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">    monitor</span><span class="token punctuation" style="color:rgb(199, 146, 234)">.</span><span class="token function" style="color:rgb(130, 170, 255)">Expose</span><span class="token punctuation" style="color:rgb(199, 146, 234)">(</span><span class="token plain">metricsRouter</span><span class="token punctuation" style="color:rgb(199, 146, 234)">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">    </span><span class="token keyword" style="font-style:italic">go</span><span class="token plain"> </span><span class="token keyword" style="font-style:italic">func</span><span class="token punctuation" style="color:rgb(199, 146, 234)">(</span><span class="token punctuation" style="color:rgb(199, 146, 234)">)</span><span class="token plain"> </span><span class="token punctuation" style="color:rgb(199, 146, 234)">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">        apiRouter</span><span class="token punctuation" style="color:rgb(199, 146, 234)">.</span><span class="token function" style="color:rgb(130, 170, 255)">Run</span><span class="token punctuation" style="color:rgb(199, 146, 234)">(</span><span class="token string" style="color:rgb(195, 232, 141)">&quot;localhost:8080&quot;</span><span class="token punctuation" style="color:rgb(199, 146, 234)">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">    </span><span class="token punctuation" style="color:rgb(199, 146, 234)">}</span><span class="token punctuation" style="color:rgb(199, 146, 234)">(</span><span class="token punctuation" style="color:rgb(199, 146, 234)">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">    </span><span class="token comment" style="color:rgb(105, 112, 152);font-style:italic">// Run the metrics server on a separate port</span><span class="token plain"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">    metricsRouter</span><span class="token punctuation" style="color:rgb(199, 146, 234)">.</span><span class="token function" style="color:rgb(130, 170, 255)">Run</span><span class="token punctuation" style="color:rgb(199, 146, 234)">(</span><span class="token string" style="color:rgb(195, 232, 141)">&quot;localhost:8081&quot;</span><span class="token punctuation" style="color:rgb(199, 146, 234)">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain"></span><span class="token punctuation" style="color:rgb(199, 146, 234)">}</span><br></span></code></pre><button type="button" aria-label="Copy code to clipboard" class="copyButton_wuS7 clean-btn">Copy</button></div></div><h2 class="anchor anchorWithStickyNavbar_mojV" id="tracing">Tracing<a class="hash-link" href="#tracing" title="Direct link to heading">â€‹</a></h2><p>To trace a request, HTTP headers carrying trace information are extracted from and injected into the request as it propagates through the microservices. A trace is made up of one or more spans. At the start of a request, a trace id is generated, which is the same for all spans, and a root span. For each service the request passes through, a new span is started as a child of the calling span.</p><img alt="Tracing example" src="/img/assets/xenit-style-guide/tracing-example.jpg"><h3 class="anchor anchorWithStickyNavbar_mojV" id="datadog">Datadog<a class="hash-link" href="#datadog" title="Direct link to heading">â€‹</a></h3><p>The middleware to use depends on the tracing provider. The main thing that differs between the providers is the HTTP headers to use. The examples below uses <a href="https://github.com/DataDog/dd-trace-go" target="_blank" rel="noopener noreferrer">Datadog</a>. Datadog&#x27;s default HTTP headers for trace and span id&#x27;s are X-Datadog-Trace-Id and X-Datadog-Parent-Id.</p><p>First, start the tracer.</p><div class="codeBlockContainer_I0IT language-go theme-code-block"><div class="codeBlockContent_wNvx go"><pre tabindex="0" class="prism-code language-go codeBlock_jd64 thin-scrollbar" style="color:#bfc7d5;background-color:#292d3e"><code class="codeBlockLines_mRuA"><span class="token-line" style="color:#bfc7d5"><span class="token keyword" style="font-style:italic">import</span><span class="token plain"> </span><span class="token string" style="color:rgb(195, 232, 141)">&quot;gopkg.in/DataDog/dd-trace-go.v1/ddtrace/tracer&quot;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain"></span><span class="token keyword" style="font-style:italic">func</span><span class="token plain"> </span><span class="token function" style="color:rgb(130, 170, 255)">main</span><span class="token punctuation" style="color:rgb(199, 146, 234)">(</span><span class="token punctuation" style="color:rgb(199, 146, 234)">)</span><span class="token plain"> </span><span class="token punctuation" style="color:rgb(199, 146, 234)">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">    tracer</span><span class="token punctuation" style="color:rgb(199, 146, 234)">.</span><span class="token function" style="color:rgb(130, 170, 255)">Start</span><span class="token punctuation" style="color:rgb(199, 146, 234)">(</span><span class="token punctuation" style="color:rgb(199, 146, 234)">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">    </span><span class="token keyword" style="font-style:italic">defer</span><span class="token plain"> tracer</span><span class="token punctuation" style="color:rgb(199, 146, 234)">.</span><span class="token function" style="color:rgb(130, 170, 255)">Stop</span><span class="token punctuation" style="color:rgb(199, 146, 234)">(</span><span class="token punctuation" style="color:rgb(199, 146, 234)">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain"></span><span class="token punctuation" style="color:rgb(199, 146, 234)">}</span><br></span></code></pre><button type="button" aria-label="Copy code to clipboard" class="copyButton_wuS7 clean-btn">Copy</button></div></div><p>Then, add the middleware that extracts and injects the tracing headers. The example below uses middleware for <a href="https://github.com/DataDog/dd-trace-go/tree/main/contrib/gin-gonic/gin" target="_blank" rel="noopener noreferrer">gin</a>.</p><div class="codeBlockContainer_I0IT language-go theme-code-block"><div class="codeBlockContent_wNvx go"><pre tabindex="0" class="prism-code language-go codeBlock_jd64 thin-scrollbar" style="color:#bfc7d5;background-color:#292d3e"><code class="codeBlockLines_mRuA"><span class="token-line" style="color:#bfc7d5"><span class="token keyword" style="font-style:italic">import</span><span class="token plain"> </span><span class="token punctuation" style="color:rgb(199, 146, 234)">(</span><span class="token plain"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">    gintrace </span><span class="token string" style="color:rgb(195, 232, 141)">&quot;gopkg.in/DataDog/dd-trace-go.v1/contrib/gin-gonic/gin&quot;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">    </span><span class="token string" style="color:rgb(195, 232, 141)">&quot;github.com/gin-gonic/gin&quot;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain"></span><span class="token punctuation" style="color:rgb(199, 146, 234)">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain"></span><span class="token keyword" style="font-style:italic">func</span><span class="token plain"> </span><span class="token function" style="color:rgb(130, 170, 255)">main</span><span class="token punctuation" style="color:rgb(199, 146, 234)">(</span><span class="token punctuation" style="color:rgb(199, 146, 234)">)</span><span class="token plain"> </span><span class="token punctuation" style="color:rgb(199, 146, 234)">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">    router </span><span class="token operator" style="color:rgb(137, 221, 255)">:=</span><span class="token plain"> gin</span><span class="token punctuation" style="color:rgb(199, 146, 234)">.</span><span class="token function" style="color:rgb(130, 170, 255)">New</span><span class="token punctuation" style="color:rgb(199, 146, 234)">(</span><span class="token punctuation" style="color:rgb(199, 146, 234)">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">    router</span><span class="token punctuation" style="color:rgb(199, 146, 234)">.</span><span class="token function" style="color:rgb(130, 170, 255)">Use</span><span class="token punctuation" style="color:rgb(199, 146, 234)">(</span><span class="token plain">gintrace</span><span class="token punctuation" style="color:rgb(199, 146, 234)">.</span><span class="token function" style="color:rgb(130, 170, 255)">Middleware</span><span class="token punctuation" style="color:rgb(199, 146, 234)">(</span><span class="token string" style="color:rgb(195, 232, 141)">&quot;my-service-name&quot;</span><span class="token punctuation" style="color:rgb(199, 146, 234)">)</span><span class="token punctuation" style="color:rgb(199, 146, 234)">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain"></span><span class="token punctuation" style="color:rgb(199, 146, 234)">}</span><br></span></code></pre><button type="button" aria-label="Copy code to clipboard" class="copyButton_wuS7 clean-btn">Copy</button></div></div><p>To add tracing for other http frameworks and libraries, see <a href="https://docs.datadoghq.com/tracing/setup_overview/compatibility_requirements/go/#compatibility" target="_blank" rel="noopener noreferrer">Go Compatibility Requirements</a>.</p><p>It is recommended to use <a href="https://docs.datadoghq.com/getting_started/tagging/unified_service_tagging/?tabs=kubernetes" target="_blank" rel="noopener noreferrer">Datadog&#x27;s Unified Service Tagging</a>, to tag the traces with the environment where the service is run and its name and version. These variables can be set when calling <code>tracer.Start()</code> or as environment variables.</p><h3 class="anchor anchorWithStickyNavbar_mojV" id="connect-logs-and-traces">Connect logs and traces<a class="hash-link" href="#connect-logs-and-traces" title="Direct link to heading">â€‹</a></h3><p>To connect logs and traces, log the span id of the current span. An example of a custom gin middleware logger that uses Datadog as tracing provider is shown below. It adds a <code>dd</code> field that holds the trace and span id. Read more on how to connect logs and traces in Datadog <a href="https://docs.datadoghq.com/tracing/faq/why-cant-i-see-my-correlated-logs-in-the-trace-id-panel/?tab=custom&amp;tabs=custom" target="_blank" rel="noopener noreferrer">here</a>.</p><div class="codeBlockContainer_I0IT language-go theme-code-block"><div class="codeBlockContent_wNvx go"><pre tabindex="0" class="prism-code language-go codeBlock_jd64 thin-scrollbar" style="color:#bfc7d5;background-color:#292d3e"><code class="codeBlockLines_mRuA"><span class="token-line" style="color:#bfc7d5"><span class="token keyword" style="font-style:italic">type</span><span class="token plain"> span </span><span class="token keyword" style="font-style:italic">struct</span><span class="token plain"> </span><span class="token punctuation" style="color:rgb(199, 146, 234)">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">    SpanID  </span><span class="token builtin" style="color:rgb(130, 170, 255)">uint64</span><span class="token plain"> </span><span class="token string" style="color:rgb(195, 232, 141)">`json:&quot;span_id&quot;`</span><span class="token plain"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">    TraceID </span><span class="token builtin" style="color:rgb(130, 170, 255)">uint64</span><span class="token plain"> </span><span class="token string" style="color:rgb(195, 232, 141)">`json:&quot;trace_id&quot;`</span><span class="token plain"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain"></span><span class="token punctuation" style="color:rgb(199, 146, 234)">}</span><span class="token plain"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain"></span><span class="token keyword" style="font-style:italic">func</span><span class="token plain"> </span><span class="token function" style="color:rgb(130, 170, 255)">getSpan</span><span class="token punctuation" style="color:rgb(199, 146, 234)">(</span><span class="token plain">c </span><span class="token operator" style="color:rgb(137, 221, 255)">*</span><span class="token plain">gin</span><span class="token punctuation" style="color:rgb(199, 146, 234)">.</span><span class="token plain">Context</span><span class="token punctuation" style="color:rgb(199, 146, 234)">)</span><span class="token plain"> span </span><span class="token punctuation" style="color:rgb(199, 146, 234)">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">    span</span><span class="token punctuation" style="color:rgb(199, 146, 234)">,</span><span class="token plain"> </span><span class="token boolean" style="color:rgb(255, 88, 116)">_</span><span class="token plain"> </span><span class="token operator" style="color:rgb(137, 221, 255)">:=</span><span class="token plain"> tracer</span><span class="token punctuation" style="color:rgb(199, 146, 234)">.</span><span class="token function" style="color:rgb(130, 170, 255)">SpanFromContext</span><span class="token punctuation" style="color:rgb(199, 146, 234)">(</span><span class="token plain">c</span><span class="token punctuation" style="color:rgb(199, 146, 234)">.</span><span class="token plain">Request</span><span class="token punctuation" style="color:rgb(199, 146, 234)">.</span><span class="token function" style="color:rgb(130, 170, 255)">Context</span><span class="token punctuation" style="color:rgb(199, 146, 234)">(</span><span class="token punctuation" style="color:rgb(199, 146, 234)">)</span><span class="token punctuation" style="color:rgb(199, 146, 234)">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">    </span><span class="token keyword" style="font-style:italic">return</span><span class="token plain"> span</span><span class="token punctuation" style="color:rgb(199, 146, 234)">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">        SpanID</span><span class="token punctuation" style="color:rgb(199, 146, 234)">:</span><span class="token plain"> span</span><span class="token punctuation" style="color:rgb(199, 146, 234)">.</span><span class="token function" style="color:rgb(130, 170, 255)">Context</span><span class="token punctuation" style="color:rgb(199, 146, 234)">(</span><span class="token punctuation" style="color:rgb(199, 146, 234)">)</span><span class="token punctuation" style="color:rgb(199, 146, 234)">.</span><span class="token function" style="color:rgb(130, 170, 255)">SpanID</span><span class="token punctuation" style="color:rgb(199, 146, 234)">(</span><span class="token punctuation" style="color:rgb(199, 146, 234)">)</span><span class="token punctuation" style="color:rgb(199, 146, 234)">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">        TraceID</span><span class="token punctuation" style="color:rgb(199, 146, 234)">:</span><span class="token plain"> span</span><span class="token punctuation" style="color:rgb(199, 146, 234)">.</span><span class="token function" style="color:rgb(130, 170, 255)">Context</span><span class="token punctuation" style="color:rgb(199, 146, 234)">(</span><span class="token punctuation" style="color:rgb(199, 146, 234)">)</span><span class="token punctuation" style="color:rgb(199, 146, 234)">.</span><span class="token function" style="color:rgb(130, 170, 255)">TraceID</span><span class="token punctuation" style="color:rgb(199, 146, 234)">(</span><span class="token punctuation" style="color:rgb(199, 146, 234)">)</span><span class="token punctuation" style="color:rgb(199, 146, 234)">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">    </span><span class="token punctuation" style="color:rgb(199, 146, 234)">}</span><span class="token plain"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain"></span><span class="token punctuation" style="color:rgb(199, 146, 234)">}</span><span class="token plain"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain"></span><span class="token keyword" style="font-style:italic">func</span><span class="token plain"> </span><span class="token function" style="color:rgb(130, 170, 255)">ginlogrWithSpan</span><span class="token punctuation" style="color:rgb(199, 146, 234)">(</span><span class="token plain">logger logr</span><span class="token punctuation" style="color:rgb(199, 146, 234)">.</span><span class="token plain">Logger</span><span class="token punctuation" style="color:rgb(199, 146, 234)">)</span><span class="token plain"> gin</span><span class="token punctuation" style="color:rgb(199, 146, 234)">.</span><span class="token plain">HandlerFunc </span><span class="token punctuation" style="color:rgb(199, 146, 234)">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">    </span><span class="token keyword" style="font-style:italic">return</span><span class="token plain"> </span><span class="token keyword" style="font-style:italic">func</span><span class="token punctuation" style="color:rgb(199, 146, 234)">(</span><span class="token plain">c </span><span class="token operator" style="color:rgb(137, 221, 255)">*</span><span class="token plain">gin</span><span class="token punctuation" style="color:rgb(199, 146, 234)">.</span><span class="token plain">Context</span><span class="token punctuation" style="color:rgb(199, 146, 234)">)</span><span class="token plain"> </span><span class="token punctuation" style="color:rgb(199, 146, 234)">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">        path </span><span class="token operator" style="color:rgb(137, 221, 255)">:=</span><span class="token plain"> c</span><span class="token punctuation" style="color:rgb(199, 146, 234)">.</span><span class="token plain">Request</span><span class="token punctuation" style="color:rgb(199, 146, 234)">.</span><span class="token plain">URL</span><span class="token punctuation" style="color:rgb(199, 146, 234)">.</span><span class="token plain">Path</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">        span </span><span class="token operator" style="color:rgb(137, 221, 255)">:=</span><span class="token plain"> </span><span class="token function" style="color:rgb(130, 170, 255)">getSpan</span><span class="token punctuation" style="color:rgb(199, 146, 234)">(</span><span class="token punctuation" style="color:rgb(199, 146, 234)">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">        </span><span class="token comment" style="color:rgb(105, 112, 152);font-style:italic">// Extract other values to log</span><span class="token plain"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">        </span><span class="token comment" style="color:rgb(105, 112, 152);font-style:italic">// ...</span><span class="token plain"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">        logger</span><span class="token punctuation" style="color:rgb(199, 146, 234)">.</span><span class="token function" style="color:rgb(130, 170, 255)">Info</span><span class="token punctuation" style="color:rgb(199, 146, 234)">(</span><span class="token plain">path</span><span class="token punctuation" style="color:rgb(199, 146, 234)">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">            </span><span class="token comment" style="color:rgb(105, 112, 152);font-style:italic">// Other fields</span><span class="token plain"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">            </span><span class="token comment" style="color:rgb(105, 112, 152);font-style:italic">// ...</span><span class="token plain"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">            </span><span class="token string" style="color:rgb(195, 232, 141)">&quot;dd&quot;</span><span class="token punctuation" style="color:rgb(199, 146, 234)">,</span><span class="token plain"> span</span><span class="token punctuation" style="color:rgb(199, 146, 234)">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">        </span><span class="token punctuation" style="color:rgb(199, 146, 234)">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">    </span><span class="token punctuation" style="color:rgb(199, 146, 234)">}</span><span class="token plain"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain"></span><span class="token punctuation" style="color:rgb(199, 146, 234)">}</span><br></span></code></pre><button type="button" aria-label="Copy code to clipboard" class="copyButton_wuS7 clean-btn">Copy</button></div></div></div><footer class="theme-doc-footer docusaurus-mt-lg"><div class="theme-doc-footer-edit-meta-row row"><div class="col"><a href="https://github.com/xenitab/xenitab.github.io/edit/main/docs/xenit-style-guide/golang.md" target="_blank" rel="noreferrer noopener" class="theme-edit-this-page"><svg fill="currentColor" height="20" width="20" viewBox="0 0 40 40" class="iconEdit_dcUD" aria-hidden="true"><g><path d="m34.5 11.7l-3 3.1-6.3-6.3 3.1-3q0.5-0.5 1.2-0.5t1.1 0.5l3.9 3.9q0.5 0.4 0.5 1.1t-0.5 1.2z m-29.5 17.1l18.4-18.5 6.3 6.3-18.4 18.4h-6.3v-6.2z"></path></g></svg>Edit this page</a></div><div class="col lastUpdated_foO9"></div></div></footer></article><nav class="pagination-nav docusaurus-mt-lg" aria-label="Docs pages navigation"><div class="pagination-nav__item"><a class="pagination-nav__link" href="/docs/xenit-style-guide/containers"><div class="pagination-nav__sublabel">Previous</div><div class="pagination-nav__label">Containers</div></a></div><div class="pagination-nav__item pagination-nav__item--next"><a class="pagination-nav__link" href="/docs/xenit-style-guide/javascript"><div class="pagination-nav__sublabel">Next</div><div class="pagination-nav__label">Javascript</div></a></div></nav></div></div><div class="col col--3"><div class="tableOfContents_cNA8 thin-scrollbar theme-doc-toc-desktop"><ul class="table-of-contents table-of-contents__left-border"><li><a href="#shared-library" class="table-of-contents__link toc-highlight">Shared Library</a></li><li><a href="#startup-and-shutdown" class="table-of-contents__link toc-highlight">Startup and Shutdown</a></li><li><a href="#program-input" class="table-of-contents__link toc-highlight">Program Input</a></li><li><a href="#logging" class="table-of-contents__link toc-highlight">Logging</a></li><li><a href="#http" class="table-of-contents__link toc-highlight">HTTP</a></li><li><a href="#metrics" class="table-of-contents__link toc-highlight">Metrics</a></li><li><a href="#tracing" class="table-of-contents__link toc-highlight">Tracing</a><ul><li><a href="#datadog" class="table-of-contents__link toc-highlight">Datadog</a></li><li><a href="#connect-logs-and-traces" class="table-of-contents__link toc-highlight">Connect logs and traces</a></li></ul></li></ul></div></div></div></div></main></div></div></div>
<script src="/assets/js/runtime~main.ac0486a3.js"></script>
<script src="/assets/js/main.d2947b01.js"></script>
</body>
</html>